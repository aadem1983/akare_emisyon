{% extends "base.html" %}

{% block title %}Formlar{% endblock %}

<style>
    /* Tıklama ile butonlar için CSS */
    .parametre-field-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 4px;
        border-radius: 6px;
        min-height: 30px;
        position: relative;
    }
    
    .field-name {
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .field-name:hover {
        background-color: #28a745 !important;
        transform: scale(1.05);
    }
    
    .field-buttons {
        display: none;
        gap: 4px;
        margin-left: 8px;
    }
    
    .field-buttons button {
        transition: all 0.2s ease;
    }
    
    .field-buttons button:hover {
        transform: scale(1.1);
    }
    
    /* Düzenleme modu için */
    .parametre-field-container.editing {
        background-color: rgba(255, 193, 7, 0.2);
        border: 1px solid #ffc107;
    }
    
    /* Zengin Metin Editörü CSS */
    .rich-text-toolbar {
        border: 1px solid #dee2e6;
        border-bottom: none;
        border-radius: 0.375rem 0.375rem 0 0;
        padding: 0.5rem;
        background-color: #f8f9fa;
    }
    
    .rich-text-editor {
        border: 1px solid #dee2e6;
        border-radius: 0 0 0.375rem 0.375rem;
        padding: 0.75rem;
        background-color: #fff;
        outline: none;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        font-family: "Times New Roman", Times, serif;
        font-size: 11pt;
        line-height: 1.5;
    }
    
    .rich-text-editor:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    .rich-text-editor[contenteditable="true"]:empty:before {
        content: attr(placeholder);
        color: #6c757d;
        font-style: italic;
    }
    
    /* Formlar sayfası için özel stiller */
    .rich-text-editor p {
        margin: 0 0 8pt 0;
        font-family: "Times New Roman", Times, serif !important;
        font-size: 11pt !important;
        line-height: 1.5 !important;
    }
    
    .rich-text-editor ul {
        margin: 0 0 8pt 0;
        padding-left: 20pt;
        font-family: "Times New Roman", Times, serif !important;
        font-size: 11pt !important;
        line-height: 1.5 !important;
    }
    
    .rich-text-editor li {
        margin: 0 0 4pt 0;
        font-family: "Times New Roman", Times, serif !important;
        font-size: 11pt !important;
        line-height: 1.5 !important;
    }
    
    .rich-text-editor strong {
        font-weight: bold;
        font-family: "Times New Roman", Times, serif;
    }
    
    .rich-text-editor em {
        font-style: italic;
        font-family: "Times New Roman", Times, serif;
    }
</style>

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>
                        Formlar
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Alt Sekmeler -->
                    <ul class="nav nav-tabs" id="formTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="kullanici-tab" data-bs-toggle="tab" data-bs-target="#kullanici" type="button" role="tab" aria-controls="kullanici" aria-selected="true">
                                <i class="fas fa-users me-1"></i>KULLANICI YÖNETİMİ
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="parametre-tab" data-bs-toggle="tab" data-bs-target="#parametre" type="button" role="tab" aria-controls="parametre" aria-selected="false">
                                <i class="fas fa-cogs me-1"></i>PARAMETRE
                            </button>
                        </li>
                                                <li class="nav-item" role="presentation">
                            <button class="nav-link" id="baca-bilgileri-tab" data-bs-toggle="tab" data-bs-target="#baca-bilgileri" type="button" role="tab" aria-controls="baca-bilgileri" aria-selected="false">
                                <i class="fas fa-chimney me-1"></i>BACA_BİLGİLERİ
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="par-saha-tab" data-bs-toggle="tab" data-bs-target="#par-saha" type="button" role="tab" aria-controls="par-saha" aria-selected="false">
                                <i class="fas fa-flask me-1"></i>PAR_SAHA
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="emisyon-form-tab" data-bs-toggle="tab" data-bs-target="#emisyon-form" type="button" role="tab" aria-controls="emisyon-form" aria-selected="false">
                                <i class="fas fa-file-pdf me-1"></i>EMİSYON FORMU
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="asg-fiyat-tab" data-bs-toggle="tab" data-bs-target="#asg-fiyat" type="button" role="tab" aria-controls="asg-fiyat" aria-selected="false">
                                <i class="fas fa-dollar-sign me-1"></i>ASG.FIYAT
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="genel-hukumler-tab" data-bs-toggle="tab" data-bs-target="#genel-hukumler" type="button" role="tab" aria-controls="genel-hukumler" aria-selected="false">
                                <i class="fas fa-gavel me-1"></i>TEKLİF METNİ
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="cihaz-lis-tab" data-bs-toggle="tab" data-bs-target="#cihaz-lis" type="button" role="tab" aria-controls="cihaz-lis" aria-selected="false">
                                <i class="fas fa-tools me-1"></i>CİHAZ LİS.
                            </button>
                        </li>
 
                    </ul>

                    <!-- Sekme İçerikleri -->
                    <div class="tab-content" id="formTabsContent">
                        <!-- KULLANICI YÖNETİMİ Sekmesi -->
                        <div class="tab-pane fade show active" id="kullanici" role="tabpanel" aria-labelledby="kullanici-tab">
                            <div class="mt-3">
                                <!-- Kullanıcı Yönetimi İçeriği -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header bg-primary text-white">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-user-plus me-2"></i>
                                                    Kullanıcı Yönetimi
                                                </h6>
                                            </div>
                                            <div class="card-body">
                                                <form method="POST" action="{{ url_for('admin') }}" id="userForm" enctype="multipart/form-data">
                                                    <input type="hidden" name="action" value="add_user" id="formAction">
                                                    <input type="hidden" name="edit_username" id="editUsername">
                                                    
                                                    <!-- Üst Kısım - Form Alanları -->
                                                    <div class="row g-3 mb-3">
                                                        <div class="col-md-6">
                                                            <label for="username" class="form-label">Kullanıcı Adı</label>
                                                            <input type="text" class="form-control" id="username" name="username" required>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="surname" class="form-label">Soyad</label>
                                                            <input type="text" class="form-control" id="surname" name="surname" required>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="password" class="form-label">Şifre</label>
                                                            <input type="password" class="form-control" id="password" name="password" required>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="gorev" class="form-label">Görev</label>
                                                            <select class="form-select" id="gorev" name="gorev" required>
                                                                <option value="">Seçin...</option>
                                                                <option value="Admin">Admin</option>
                                                                <option value="Saha">Saha</option>
                                                                <option value="Rap">Rap</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="role" class="form-label">Rol</label>
                                                            <select class="form-select" id="role" name="role" required>
                                                                <option value="">Seçin...</option>
                                                                <option value="1">1 - Sadece Okuma</option>
                                                                <option value="2">2 - Okuma Yazma</option>
                                                                <option value="3">3 - Okuma Yazma Değiştirme</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="imza" class="form-label">İmza</label>
                                                            <div class="input-group">
                                                                <input type="file" class="form-control" id="imza" name="imza" accept="image/*" style="display: none;">
                                                                <input type="text" class="form-control" id="imzaText" placeholder="İmza seçilmedi" readonly>
                                                                <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('imza').click()">
                                                                    <i class="fas fa-upload me-1"></i>İmza Ekle
                                                                </button>
                                                            </div>
                                                            <div id="imzaPreview" class="mt-2" style="display: none;">
                                                                <img id="imzaImage" src="" alt="İmza Önizleme" style="max-width: 100px; max-height: 50px; border: 1px solid #ddd;">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="asgFiyat" class="form-label">ASG.FIYAT</label>
                                                            <input type="number" class="form-control" id="asgFiyat" name="asgFiyat" step="0.01" placeholder="0.00">
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Alt Kısım - Butonlar -->
                                                    <div class="row g-2">
                                                        <div class="col-md-4">
                                                            <button type="button" class="btn btn-success w-100" id="yeniEkleBtn">
                                                                <i class="fas fa-plus me-1"></i>Yeni Ekle
                                                            </button>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <button type="button" class="btn btn-warning w-100" id="guncelleBtn" disabled>
                                                                <i class="fas fa-edit me-1"></i>Güncelle
                                                            </button>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <button type="button" class="btn btn-primary w-100" id="kaydetBtn">
                                                                <i class="fas fa-save me-1"></i>Kaydet
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-list me-2"></i>
                                                    Kullanıcı Listesi
                                                </h6>
                                                <div class="btn-group" role="group">
                                                    <button type="button" class="btn btn-danger btn-sm" onclick="deleteSelectedUsers()">
                                                        <i class="fas fa-trash me-1"></i>Seçilenleri Sil
                                                    </button>
                                                    <button type="button" class="btn btn-success btn-sm" onclick="exportSelectedUsers()">
                                                        <i class="fas fa-download me-1"></i>Seçilenleri Dışa Aktar
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover">
                                                        <thead class="table-dark">
                                                            <tr>
                                                                <th width="50">
                                                                    <input type="checkbox" id="selectAllUsers" onchange="toggleSelectAllUsers()">
                                                                </th>
                                                                <th width="60">Sıra</th>
                                                                <th>Kullanıcı Adı</th>
                                                                <th>Soyad</th>
                                                                <th>Görev</th>
                                                                <th>Rol</th>
                                                                <th width="80">İmza</th>
                                                                <th width="100">ASG.FIYAT</th>
                                                                <th width="120">İşlemler</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for username, user_data in users.items() %}
                                                            <tr>
                                                                <td>
                                                                    <input type="checkbox" class="user-checkbox" value="{{ username }}">
                                                                </td>
                                                                <td>{{ loop.index }}</td>
                                                                <td>{{ username }}</td>
                                                                <td>{{ user_data.surname if user_data.surname else '-' }}</td>
                                                                <td>{{ user_data.gorev if user_data.gorev else '-' }}</td>
                                                                <td>
                                                                    <span class="badge {% if user_data.role == 'admin' %}bg-success{% else %}bg-primary{% endif %}">
                                                                        {{ user_data.role }}
                                                                    </span>
                                                                </td>
                                                                <td>
                                                                    {% if user_data.imza %}
                                                                        <img src="{{ url_for('static', filename='images/signatures/' + user_data.imza) }}" 
                                                                             alt="İmza" style="max-width: 60px; max-height: 30px; border: 1px solid #ddd;">
                                                                    {% else %}
                                                                        <span class="text-muted">-</span>
                                                                    {% endif %}
                                                                </td>
                                                                <td>
                                                                    <span class="text-muted">{{ user_data.asgFiyat if user_data.asgFiyat else '-' }}</span>
                                                                </td>
                                                                <td>
                                                                    <div class="btn-group btn-group-sm" role="group">
                                                                        <button type="button" class="btn btn-outline-primary edit-user-btn" 
                                                                                data-username="{{ username }}"
                                                                                data-surname="{{ user_data.surname if user_data.surname else '' }}"
                                                                                data-gorev="{{ user_data.gorev if user_data.gorev else '' }}"
                                                                                data-role="{{ user_data.role }}"
                                                                                data-imza="{{ user_data.imza if user_data.imza else '' }}"
                                                                                title="Düzenle">
                                                                            <i class="fas fa-pencil-alt"></i>
                                                                        </button>
                                                                        <button type="button" class="btn btn-outline-danger delete-user-btn" 
                                                                                data-username="{{ username }}"
                                                                                title="Sil">
                                                                            <i class="fas fa-times"></i>
                                                                        </button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PARAMETRE Sekmesi -->
                        <div class="tab-pane fade" id="parametre" role="tabpanel" aria-labelledby="parametre-tab">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h4 class="mb-0">Parametre Yönetimi</h4>
                                    <div class="btn-toolbar">
                                        <div class="btn-group me-2">
                                            <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#importModal">
                                                <i class="fas fa-file-upload me-1"></i>İçeri Aktar
                                            </button>
                                            <a href="{{ url_for('export_parameters') }}" class="btn btn-info btn-sm">
                                                <i class="fas fa-file-download me-1"></i>Dışarı Aktar
                                            </a>
                                            <button type="button" class="btn btn-warning btn-sm" id="secilenleriAktar" disabled>
                                                <i class="fas fa-file-download me-1"></i>Seçilenleri Dışa Aktar
                                            </button>
                                            {% if role in ['3', 'admin'] %}
                                            <button type="button" class="btn btn-danger btn-sm" id="secilenleriSil" disabled>
                                                <i class="fas fa-trash me-1"></i>Seçilenleri Sil
                                            </button>
                                            {% endif %}
                                        </div>
                                        {% if role in ['2', '3', 'admin'] %}
                                        <a href="{{ url_for('add_parameter') }}" class="btn btn-primary btn-sm shadow-sm">
                                            <i class="fas fa-plus me-1"></i>Yeni Parametre Ekle
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="card border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <input type="text" id="parametreArama" class="form-control" placeholder="Parametre adına göre ara...">
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle" id="parametreTablo">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 35px;" class="no-sort">
                                                            <input type="checkbox" id="tumunuSec" class="form-check-input">
                                                        </th>
                                                        <th style="width: 45px;" class="no-sort">Sıra</th>
                                                        <th style="width: 120px;">Parametre Adı</th>
                                                        <th style="width: 80px;">Metot</th>
                                                        <th style="width: 70px;">İzo Oran</th>
                                                        <th style="width: 60px;">Nozzle</th>
                                                        <th style="width: 55px;">1. İmp</th>
                                                        <th style="width: 55px;">2. İmp</th>
                                                        <th style="width: 55px;">3. İmp</th>
                                                        <th style="width: 55px;">4. İmp</th>
                                                        <th style="width: 60px;">L/DAK</th>
                                                        <th style="width: 60px;">T.HAC</th>
                                                        <th style="width: 60px;">LOQ</th>
                                                        <th style="width: 50px;">KK</th>
                                                        <th style="width: 50px;">-3S</th>
                                                        <th style="width: 50px;">-2S</th>
                                                        <th style="width: 50px;">+2S</th>
                                                        <th style="width: 50px;">+3S</th>
                                                        <th style="width: 80px;" class="text-end no-sort">İşlemler</th>
                                                    </tr>

                                                </thead>
                                                <tbody>
                                                    {% if parameters %}
                                                        {% for param in parameters %}
                                                        <tr>
                                                            <td>
                                                                <input type="checkbox" class="form-check-input parametre-checkbox" value="{{ param.id }}">
                                                            </td>
                                                            <td class="text-center fw-bold text-muted">{{ loop.index }}</td>
                                                            <td>{{ param['Parametre Adı'] | default('', true) }}</td>
                                                            <td>{{ param['Metot'] | default('', true) }}</td>
                                                            <td>{{ param['İzo Oran'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['Nozzle'] | default('', true) }}</td>
                                                            <td>{{ param['1. imp'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['2. imp'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['3. imp'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['4. imp'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['L/DAK'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['T.HAC'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['LOQ'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['KK'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['-3S'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['-2S'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['+2S'] | default('', true) | replace('.', ',') }}</td>
                                                            <td>{{ param['+3S'] | default('', true) | replace('.', ',') }}</td>
                                                            <td class="text-end">
                                                                <div class="btn-group btn-group-sm" role="group">
                                                                    {% if role in ['2', '3', 'admin'] %}
                                                                    <a href="{{ url_for('edit_parameter', parameter_id=param.id) }}" class="btn btn-outline-warning" title="Düzenle">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                    {% endif %}
                                                                    {% if role in ['3', 'admin'] %}
                                                                    <button type="button" class="btn btn-outline-danger delete-parametre-btn" data-id="{{ param.id }}" title="Sil">
                                                                        <i class="fas fa-times"></i>
                                                                    </button>
                                                                    {% endif %}
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    {% else %}
                                                        <tr>
                                                            <td colspan="20" class="text-center text-muted py-4">
                                                                <i class="fas fa-inbox fa-2x mb-2"></i>
                                                                <br>Henüz parametre bulunmuyor
                                                            </td>
                                                        </tr>
                                                    {% endif %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- BACA_BİLGİLERİ Sekmesi -->
                        <div class="tab-pane fade" id="baca-bilgileri" role="tabpanel" aria-labelledby="baca-bilgileri-tab">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h4 class="mb-0">Baca Bilgileri Yönetimi</h4>
                                    <div class="btn-toolbar">
                                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#bacaParaEkleModal">
                                            <i class="fas fa-plus me-1"></i>Baca Para Ekle
                                        </button>
                                        <div class="btn-group me-2 ms-2">
                                            <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#importBacaModal">
                                                <i class="fas fa-file-upload me-1"></i>İçeri Aktar
                                            </button>
                                            <a href="{{ url_for('export_baca_bilgileri') }}" class="btn btn-info btn-sm">
                                                <i class="fas fa-file-download me-1"></i>Dışarı Aktar
                                            </a>
                                            <button type="button" class="btn btn-danger btn-sm" id="secilenleriSilBaca" disabled>
                                                <i class="fas fa-trash me-1"></i>Seçilenleri Sil
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="card border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle" id="bacaParaTablo">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 35px;" class="no-sort">
                                                            <input type="checkbox" id="tumunuSecBaca" class="form-check-input">
                                                        </th>
                                                        <th style="width: 50px;" class="no-sort">Sıra</th>
                                                        <th style="width: 200px;">BACA PARA ADI</th>
                                                        <th style="width: 300px;">LİSTE İÇERİĞİ</th>
                                                        <th style="width: 100px;" class="text-end no-sort">İşlemler</th>
                                                    </tr>
                                                </thead>
                                                                                                 <tbody>
                                                     {% if baca_paralar %}
                                                         {% for para in baca_paralar %}
                                                         <tr>
                                                             <td>
                                                                 <input type="checkbox" class="form-check-input baca-para-checkbox" value="{{ para.id }}">
                                                             </td>
                                                             <td class="text-center fw-bold text-muted">{{ loop.index }}</td>
                                                             <td>{{ para.baca_par_adi }}</td>
                                                             <td>{{ para.liste_icerigi if para.liste_icerigi else '-' }}</td>
                                                             <td class="text-end">
                                                                 <div class="btn-group btn-group-sm" role="group">
                                                                     <button type="button" class="btn btn-outline-warning edit-baca-para-btn" 
                                                                             data-id="{{ para.id }}" 
                                                                             data-baca-par-adi="{{ para.baca_par_adi }}"
                                                                             data-liste-icerigi="{{ para.liste_icerigi }}"
                                                                             title="Düzenle">
                                                                         <i class="fas fa-pencil-alt"></i>
                                                                     </button>
                                                                     <button type="button" class="btn btn-outline-danger delete-baca-para-btn" 
                                                                             data-id="{{ para.id }}"
                                                                             data-baca-par-adi="{{ para.baca_par_adi }}"
                                                                             title="Sil">
                                                                         <i class="fas fa-times"></i>
                                                                     </button>
                                                                 </div>
                                                             </td>
                                                         </tr>
                                                         {% endfor %}
                                                     {% else %}
                                                         <tr>
                                                             <td colspan="4" class="text-center text-muted py-4">
                                                                 <i class="fas fa-inbox fa-2x mb-2"></i>
                                                                 <br>Henüz baca parametresi bulunmuyor
                                                             </td>
                                                         </tr>
                                                     {% endif %}
                                                 </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PAR_SAHA Sekmesi -->
                        <div class="tab-pane fade" id="par-saha" role="tabpanel" aria-labelledby="par-saha-tab">
                            <div class="mt-3">
                                                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="mb-0">Parametre Sahabil Yönetimi</h4>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-success" onclick="importParametreFields()">
                                <i class="fas fa-file-excel me-1"></i>İçe Aktar
                            </button>
                            <button type="button" class="btn btn-info" onclick="exportParametreFields()">
                                <i class="fas fa-download me-1"></i>Dışa Aktar
                            </button>
                            <button type="button" class="btn btn-danger" onclick="clearParametreFields()">
                                <i class="fas fa-trash me-1"></i>Sil
                            </button>
                            <button type="button" id="toggleEditImportExport" class="btn btn-secondary">
                                <i class="fas fa-edit me-1"></i>Düzenleme
                            </button>
                            <button type="button" id="saveImportExport" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Kaydet
                            </button>
                        </div>
                    </div>

                                                                        <!-- Gizli dosya input'u -->
                    <input type="file" id="parametreFieldsFile" accept=".xlsx,.xls" style="display: none;" onchange="handleParametreFieldsFile(this)">
                    
                    <!-- İçe/Dışa Aktarma Format Tablosu -->
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-table me-2"></i>
                                İçe/Dışa Aktarma Format Tablosu
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-sm" id="importExportTable">
                                    <thead class="table-dark">
                                        <tr>
                                            <th style="width: 200px;">TOZ, A.MET, SÜLF.A, HF, HCL, AMON., FORM., CR6, FOSF.A., HCN</th>
                                            <th style="width: 150px;">NEM</th>
                                            <th style="width: 150px;">YG</th>
                                            <th style="width: 150px;">TOC</th>
                                            <th style="width: 150px;">VOC</th>
                                            <th style="width: 150px;">PM10</th>
                                            <th style="width: 150px;">ÇT</th>
                                            <th style="width: 100px;">boş</th>
                                            <th style="width: 100px;">boş</th>
                                        </tr>
                                        <tr>
                                            <th class="table-secondary">TARİH</th>
                                            <th class="table-secondary">TARİH</th>
                                            <th class="table-secondary">TARİH</th>
                                            <th class="table-secondary">TARİH</th>
                                            <th class="table-secondary">TARİH</th>
                                            <th class="table-secondary">TARİH</th>
                                            <th class="table-secondary">TARİH</th>
                                            <th class="table-secondary"></th>
                                            <th class="table-secondary"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="fw-bold">METOT</td>
                                            <td>1İMP-İ</td>
                                            <td class="fw-bold">B.SIC</td>
                                            <td class="fw-bold">B.NEM</td>
                                            <td class="fw-bold">GAZ HAC.</td>
                                            <td class="fw-bold">METOT</td>
                                            <td class="fw-bold">T.İÇİ-1</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">NOZZLE ÇAP</td>
                                            <td>1-İMP-S</td>
                                            <td class="fw-bold">O2</td>
                                            <td class="fw-bold">B.SIC</td>
                                            <td class="fw-bold">GAZ.SIC.</td>
                                            <td class="fw-bold">ORT.SIC</td>
                                            <td class="fw-bold">T.İÇİ-2</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">TRAVERS</td>
                                            <td>2-İMP-İ</td>
                                            <td class="fw-bold">CO</td>
                                            <td class="fw-bold">TOC(PPM)</td>
                                            <td class="fw-bold">SEY.GAZ.HAC</td>
                                            <td class="fw-bold">ORT.NEM</td>
                                            <td class="fw-bold">T.İÇİ-3</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">B.HIZ</td>
                                            <td>2-İMP-S</td>
                                            <td class="fw-bold">NO</td>
                                            <td class="fw-bold">KK1-O</td>
                                            <td class="fw-bold">SEY.GAZ.SIC</td>
                                            <td class="fw-bold">ORT.RUZ.HIZ</td>
                                            <td class="fw-bold">T.İÇİ-4</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">B.SIC</td>
                                            <td>3-İMP-İ</td>
                                            <td class="fw-bold">NOX</td>
                                            <td class="fw-bold">KK1-SPAN</td>
                                            <td></td>
                                            <td class="fw-bold">ÇEK.HACİM</td>
                                            <td class="fw-bold">T-DIŞ-1</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">B.BAS(KPA)</td>
                                            <td>3-İMP-S</td>
                                            <td class="fw-bold">SO2</td>
                                            <td class="fw-bold">KK2-O</td>
                                            <td></td>
                                            <td class="fw-bold">SYC.İLK</td>
                                            <td class="fw-bold">T.DIŞ-2</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">B.NEM(G/M3)</td>
                                            <td>HAC.</td>
                                            <td class="fw-bold">KK1-O2</td>
                                            <td class="fw-bold">KK2-SPAN</td>
                                            <td></td>
                                            <td class="fw-bold">SYC.SON</td>
                                            <td class="fw-bold">T.DIŞ-3</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">B.NEM(%)</td>
                                            <td></td>
                                            <td class="fw-bold">KK1-CO</td>
                                            <td></td>
                                            <td></td>
                                            <td class="fw-bold">ISDL</td>
                                            <td class="fw-bold">TDİS-4</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">SYC.HAC.</td>
                                            <td></td>
                                            <td class="fw-bold">KK1-NO</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td class="fw-bold">İLK KURULUM</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">SYC.İLK</td>
                                            <td></td>
                                            <td class="fw-bold">KK1-SO2</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td class="fw-bold">2. KURULUM</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">SYC.SON</td>
                                            <td></td>
                                            <td class="fw-bold">KK2-O2</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td class="fw-bold">TOPLAMA</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">SYC.SIC</td>
                                            <td></td>
                                            <td class="fw-bold">KK2-CO</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">DEBİ</td>
                                            <td></td>
                                            <td class="fw-bold">KK2-NO</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">ISDL</td>
                                            <td></td>
                                            <td class="fw-bold">KK2-SO2</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td class="fw-bold">T90</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                            </div>
                        </div>

                        <!-- EMİSYON FORMU Sekmesi -->
                        <div class="tab-pane fade" id="emisyon-form" role="tabpanel" aria-labelledby="emisyon-form-tab">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h4 class="mb-0">Form Yönetimi</h4>
                                    <div class="btn-toolbar">
                                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#formEkleModal">
                                            <i class="fas fa-plus me-1"></i>Yeni Ekle
                                        </button>
                                        <div class="btn-group btn-group-sm ms-2" role="group">
                                            <button type="button" class="btn btn-success" onclick="exportForms('excel')" title="Excel'e Aktar">
                                                <i class="fas fa-file-excel me-1"></i>Excel
                                            </button>
                                            <button type="button" class="btn btn-info" onclick="exportForms('word')" title="Word'e Aktar">
                                                <i class="fas fa-file-word me-1"></i>Word
                                            </button>
                                            <button type="button" class="btn btn-danger" onclick="exportForms('pdf')" title="PDF'e Aktar">
                                                <i class="fas fa-file-pdf me-1"></i>PDF
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="card border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle" id="formTablo">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 50px;" class="no-sort">Sıra</th>
                                                        <th style="width: 200px;">FORM ADI</th>
                                                        <th style="width: 150px;">FORM KODU</th>
                                                        <th style="width: 120px;">YAYIN TARİHİ</th>
                                                        <th style="width: 120px;">REVİZYON TARİHİ</th>
                                                        <th style="width: 100px;">REVİZYON NO</th>
                                                        <th style="width: 100px;" class="text-end no-sort">İşlemler</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="formTabloBody">
                                                    <!-- Formlar buraya yüklenecek -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ASG.FIYAT Sekmesi -->
                        <div class="tab-pane fade" id="asg-fiyat" role="tabpanel" aria-labelledby="asg-fiyat-tab">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h4 class="mb-0">Asgari Fiyat Tablosu</h4>
                                    <div class="btn-toolbar">
                                        <button type="button" class="btn btn-primary btn-sm" onclick="addNewAsgRow()">
                                            <i class="fas fa-plus me-1"></i>Yeni Ekle
                                        </button>
                                        <button type="button" class="btn btn-success btn-sm" onclick="saveAsgFiyatTable()">
                                            <i class="fas fa-save me-1"></i>Kaydet
                                        </button>
                                        <button type="button" class="btn btn-info btn-sm" onclick="exportAsgFiyatTable()">
                                            <i class="fas fa-download me-1"></i>Dışa Aktar
                                        </button>
                                        <button type="button" class="btn btn-danger btn-sm" onclick="deleteSelectedAsgRows()">
                                            <i class="fas fa-trash me-1"></i>Seçilenleri Sil
                                        </button>
                                        <button type="button" class="btn btn-warning btn-sm" onclick="importAsgFiyatTable()">
                                            <i class="fas fa-upload me-1"></i>İçe Aktar
                                        </button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover table-sm">
                                        <thead class="table-primary">
                                            <tr>
                                                <th rowspan="2" class="align-middle" style="width: 40px;"><input type="checkbox" id="asgSelectAll"></th>
                                                <th rowspan="2" class="align-middle" style="width: 60px;">SIRA</th>
                                                <th rowspan="2" class="align-middle">PARAMETRE</th>
                                                <th rowspan="2" class="align-middle" style="width: 200px;">METOT</th>
                                                <th colspan="10" class="text-center">YIL</th>
                                                <th rowspan="2" class="align-middle" style="width: 120px;">İŞLEMLER</th>
                                            </tr>
                                            <tr>
                                                <th>2025</th>
                                                <th>2026</th>
                                                <th>2027</th>
                                                <th>2028</th>
                                                <th>2029</th>
                                                <th>2030</th>
                                                <th>2031</th>
                                                <th>2032</th>
                                                <th>2033</th>
                                                <th>2034</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><input type="checkbox" class="asg-row-checkbox"></td>
                                                <td>1</td>
                                                <td>TABAN FİYAT</td>
                                                <td></td>
                                                <td><input type="number" class="form-control form-control-sm" value="9265.00" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                            </tr>
                                            <tr>
                                                <td>YOL</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>TOZ</td>
                                                <td>Epa 5/Epa 17/Ts En 13284-1/Ts 9096</td>
                                                <td><input type="number" class="form-control form-control-sm" value="6655" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                            </tr>
                                            <tr>
                                                <td>YANMA GAZI</td>
                                                <td>So2/No/Co/O2</td>
                                                <td><input type="number" class="form-control form-control-sm" value="3855" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>VOC</td>
                                                <td>TS 13649</td>
                                                <td><input type="number" class="form-control form-control-sm" value="13170" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>TOC</td>
                                                <td>TS EN 12619</td>
                                                <td><input type="number" class="form-control form-control-sm" value="13170" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>HIZ</td>
                                                <td>EPA Metot 2 / TS ISO 10780</td>
                                                <td><input type="number" class="form-control form-control-sm" value="1430" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NEM</td>
                                                <td>EPA 4 - İŞLETME İÇİ METOT</td>
                                                <td><input type="number" class="form-control form-control-sm" value="1430" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>AĞIR METAL</td>
                                                <td>EPA 29/TS 14384</td>
                                                <td><input type="number" class="form-control form-control-sm" value="19000" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>SÜLFÜRİK ASİT</td>
                                                <td>EPA 8</td>
                                                <td><input type="number" class="form-control form-control-sm" value="6290" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>HF</td>
                                                <td>IOS 15713/EPA 13A</td>
                                                <td><input type="number" class="form-control form-control-sm" value="7505" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>HCL</td>
                                                <td>ITS EN 1911</td>
                                                <td><input type="number" class="form-control form-control-sm" value="7505" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>AMONYAK</td>
                                                <td>SCAWMD METOT 207.1</td>
                                                <td><input type="number" class="form-control form-control-sm" value="6645" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>İSLİLİK</td>
                                                <td></td>
                                                <td><input type="number" class="form-control form-control-sm" value="710" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>FORMALDEHİT</td>
                                                <td>EPA METOT323</td>
                                                <td><input type="number" class="form-control form-control-sm" value="6685" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>CR+6</td>
                                                <td>CARB 425</td>
                                                <td><input type="number" class="form-control form-control-sm" value="6290" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>FOSFORİK ASİT</td>
                                                <td>Nmx-aa-90-1986</td>
                                                <td><input type="number" class="form-control form-control-sm" value="6290" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>HCN</td>
                                                <td>CARB 426</td>
                                                <td><input type="number" class="form-control form-control-sm" value="6810" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>DİOKSİN FURAN</td>
                                                <td></td>
                                                <td><input type="number" class="form-control form-control-sm" value="83950" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PAH</td>
                                                <td>ISO 11338-1/2</td>
                                                <td><input type="number" class="form-control form-control-sm" value="42220" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PM10</td>
                                                <td>EPA 40 cfr 50 appj</td>
                                                <td><input type="number" class="form-control form-control-sm" value="7370" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>ÇÖKEN TOZ</td>
                                                <td>TS 2342</td>
                                                <td><input type="number" class="form-control form-control-sm" value="6640" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>MODELLEME</td>
                                                <td></td>
                                                <td><input type="number" class="form-control form-control-sm" value="10560" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td><input type="number" class="form-control form-control-sm" value="" step="0.01" placeholder="0.00"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" title="Düzenle">
                                                            <i class="fas fa-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-outline-warning" title="Güncelle">
                                                            <i class="fas fa-sync"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" title="Sil">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-VOC</td>
                                                <td>ITS 13649</td>
                                                <td>10210</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-AĞIR METAL</td>
                                                <td>EPA 29/TS 14384</td>
                                                <td>14070</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-SÜLFÜRİK ASİT</td>
                                                <td>EPA 8</td>
                                                <td>2000</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-HF</td>
                                                <td>IOS 15713/EPA 13A</td>
                                                <td>3215</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-HCL</td>
                                                <td>ITS EN 1911</td>
                                                <td>3215</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-AMONYAK</td>
                                                <td>SCAWMD METOT 207.1</td>
                                                <td>2335</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-FOSFORİK ASİT</td>
                                                <td>Nmx-aa-90-1986</td>
                                                <td>2000</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-HCN</td>
                                                <td>CARB 426</td>
                                                <td>2520</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>ANALİZ-CR+6</td>
                                                <td>CARB 425</td>
                                                <td>2000</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- TEKLİF METNİ Sekmesi -->
                        <div class="tab-pane fade" id="genel-hukumler" role="tabpanel" aria-labelledby="genel-hukumler-tab">
                            <div class="mt-3">
                                <div class="row">
                                    <!-- Sol Sütun - Teklif Giriş -->
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header bg-primary text-white">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-file-alt me-2"></i>
                                                    Teklif Giriş Metni
                                                </h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="rich-text-toolbar mb-2">
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('teklifGirisText', 'bold')">
                                                        <i class="fas fa-bold"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('teklifGirisText', 'italic')">
                                                        <i class="fas fa-italic"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('teklifGirisText', 'underline')">
                                                        <i class="fas fa-underline"></i>
                                                    </button>
                                                    <select class="form-select form-select-sm d-inline-block w-auto ms-2" onchange="changeFontFamily('teklifGirisText', this.value)">
                                                        <option value="Arial">Arial</option>
                                                        <option value="Times New Roman">Times New Roman</option>
                                                        <option value="Calibri">Calibri</option>
                                                        <option value="Verdana">Verdana</option>
                                                        <option value="Tahoma">Tahoma</option>
                                                        <option value="Georgia">Georgia</option>
                                                    </select>
                                                    <select class="form-select form-select-sm d-inline-block w-auto ms-2" onchange="changeFontSize('teklifGirisText', this.value)">
                                                        <option value="10">10px</option>
                                                        <option value="12">12px</option>
                                                        <option value="14">14px</option>
                                                        <option value="16">16px</option>
                                                        <option value="18">18px</option>
                                                        <option value="20">20px</option>
                                                    </select>
                                                    <select class="form-select form-select-sm d-inline-block w-auto ms-2" onchange="changeLineHeight('teklifGirisText', this.value)">
                                                        <option value="1">1.0</option>
                                                        <option value="1.25">1.25</option>
                                                        <option value="1.5" selected>1.5</option>
                                                        <option value="2">2.0</option>
                                                    </select>
                                                </div>
                                                <div class="form-control rich-text-editor" id="teklifGirisText" contenteditable="true" style="min-height: 400px; max-height: 600px; overflow-y: auto;" placeholder="Teklif giriş metnini buraya yapıştırın..."></div>
                                                <div class="mt-3">
                                                    <button type="button" class="btn btn-primary" onclick="teklifGirisMetniGuncelle()">
                                                        <i class="fas fa-save me-1"></i>
                                                        Teklif Giriş Metni Güncelle
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Sağ Sütun - Genel Hükümler -->
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header bg-success text-white">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-gavel me-2"></i>
                                                    Genel Hükümler Metni
                                                </h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="rich-text-toolbar mb-2">
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('genelHukumlerText', 'bold')">
                                                        <i class="fas fa-bold"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('genelHukumlerText', 'italic')">
                                                        <i class="fas fa-italic"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('genelHukumlerText', 'underline')">
                                                        <i class="fas fa-underline"></i>
                                                    </button>
                                                    <select class="form-select form-select-sm d-inline-block w-auto ms-2" onchange="changeFontFamily('genelHukumlerText', this.value)">
                                                        <option value="Arial">Arial</option>
                                                        <option value="Times New Roman">Times New Roman</option>
                                                        <option value="Calibri">Calibri</option>
                                                        <option value="Verdana">Verdana</option>
                                                        <option value="Tahoma">Tahoma</option>
                                                        <option value="Georgia">Georgia</option>
                                                    </select>
                                                    <select class="form-select form-select-sm d-inline-block w-auto ms-2" onchange="changeFontSize('genelHukumlerText', this.value)">
                                                        <option value="10">10px</option>
                                                        <option value="12">12px</option>
                                                        <option value="14">14px</option>
                                                        <option value="16">16px</option>
                                                        <option value="18">18px</option>
                                                        <option value="20">20px</option>
                                                    </select>
                                                    <select class="form-select form-select-sm d-inline-block w-auto ms-2" onchange="changeLineHeight('genelHukumlerText', this.value)">
                                                        <option value="1">1.0</option>
                                                        <option value="1.25">1.25</option>
                                                        <option value="1.5" selected>1.5</option>
                                                        <option value="2">2.0</option>
                                                    </select>
                                                </div>
                                                <div class="form-control rich-text-editor" id="genelHukumlerText" contenteditable="true" style="min-height: 400px; max-height: 600px; overflow-y: auto;" placeholder="Genel hükümler metnini buraya yapıştırın..."></div>
                                                <div class="mt-3">
                                                    <button type="button" class="btn btn-primary" onclick="maddeleriGuncelle()">
                                                        <i class="fas fa-save me-1"></i>
                                                        Maddeleri Güncelle
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CİHAZ LİS. Sekmesi -->
                        <div class="tab-pane fade" id="cihaz-lis" role="tabpanel" aria-labelledby="cihaz-lis-tab">
                            <div class="mt-3">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-tools me-2"></i>
                                                    Cihaz Listesi
                                                </h6>
                                                <div>
                                                    <button type="button" class="btn btn-success btn-sm me-2" onclick="saveAllCihazlar()">
                                                        <i class="fas fa-save me-1"></i>Kaydet
                                                    </button>
                                                    <button type="button" class="btn btn-danger btn-sm me-2" onclick="deleteSelectedCihazlar()">
                                                        <i class="fas fa-trash me-1"></i>Seçilenleri Sil
                                                    </button>
                                                    <button type="button" class="btn btn-info btn-sm me-2" onclick="exportSelectedCihazlar()">
                                                        <i class="fas fa-file-excel me-1"></i>Excel'e Aktar
                                                    </button>
                                                    <button type="button" class="btn btn-secondary btn-sm me-2" onclick="importFromExcel()">
                                                        <i class="fas fa-file-import me-1"></i>Excel'den Aktar
                                                    </button>
                                                    <button type="button" class="btn btn-warning btn-sm me-2" onclick="addNewRow()">
                                                        <i class="fas fa-plus me-1"></i>Satır Ekle
                                                    </button>
                                                    <button type="button" class="btn btn-primary btn-sm" onclick="showCihazEkleModal()">
                                                        <i class="fas fa-plus me-1"></i>Yeni Cihaz Ekle
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <!-- Gizli dosya input -->
                                                <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleExcelFile(this)">
                                                
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover" id="cihazTable">
                                                        <thead class="table-dark">
                                                            <tr>
                                                                <th style="width: 50px;">
                                                                    <input type="checkbox" id="selectAllCihazlar" onchange="toggleSelectAllCihazlar()">
                                                                </th>
                                                                <th style="width: 80px;">SIRA</th>
                                                                <th style="width: 120px;">PARAM</th>
                                                                <th style="width: 180px;">CHZ ADI</th>
                                                                <th style="width: 150px;">MARKA</th>
                                                                <th style="width: 150px;">MODEL</th>
                                                                <th style="width: 150px;">SERİ NO</th>
                                                                <th style="width: 120px;">2026</th>
                                                                <th style="width: 120px;">2027</th>
                                                                <th style="width: 120px;">2028</th>
                                                                <th style="width: 120px;">2029</th>
                                                                <th style="width: 120px;">2030</th>
                                                                <th style="width: 120px;">2031</th>
                                                                <th style="width: 120px;">2032</th>
                                                                <th style="width: 120px;">2033</th>
                                                                <th style="width: 100px;">İşlemler</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="cihazTableBody">
                                                            <!-- Cihaz verileri buraya eklenecek -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

 <!-- Cihaz Ekleme Modal -->
 <div class="modal fade" id="cihazEkleModal" tabindex="-1" aria-labelledby="cihazEkleModalLabel" aria-hidden="true">
     <div class="modal-dialog modal-lg">
         <div class="modal-content">
             <div class="modal-header">
                 <h5 class="modal-title" id="cihazEkleModalLabel">Yeni Cihaz Ekle</h5>
                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
             </div>
             <div class="modal-body">
                 <form id="cihazEkleForm">
                     <div class="row g-3">
                         <div class="col-md-6">
                             <label for="cihazParam" class="form-label">PARAM <span class="text-danger">*</span></label>
                             <select class="form-select" id="cihazParam" name="param" required>
                                 <option value="">Seçin...</option>
                                 <option value="YG">YG</option>
                                 <option value="TOZ">TOZ</option>
                                 <option value="VOC">VOC</option>
                                 <option value="TOC">TOC</option>
                                 <option value="NEM">NEM</option>
                                 <option value="SO2">SO2</option>
                                 <option value="NO">NO</option>
                                 <option value="CO">CO</option>
                                 <option value="O2">O2</option>
                             </select>
                         </div>
                         <div class="col-md-6">
                             <label for="cihazAdi" class="form-label">CHZ ADI <span class="text-danger">*</span></label>
                             <input type="text" class="form-control" id="cihazAdi" name="chzAdi" required>
                         </div>
                         <div class="col-md-6">
                             <label for="cihazMarka" class="form-label">MARKA <span class="text-danger">*</span></label>
                             <input type="text" class="form-control" id="cihazMarka" name="marka" required>
                         </div>
                         <div class="col-md-6">
                             <label for="cihazModel" class="form-label">MODEL <span class="text-danger">*</span></label>
                             <input type="text" class="form-control" id="cihazModel" name="model" required>
                         </div>
                         <div class="col-md-6">
                             <label for="cihazSeriNo" class="form-label">SERİ NO <span class="text-danger">*</span></label>
                             <input type="text" class="form-control" id="cihazSeriNo" name="seriNo" required>
                         </div>
                         <div class="col-md-6">
                             <label for="cihazSira" class="form-label">SIRA NO</label>
                             <input type="number" class="form-control" id="cihazSira" name="sira" min="1" max="19">
                         </div>
                     </div>
                     <div class="row g-3 mt-2">
                         <div class="col-12">
                             <h6 class="text-muted">Yıllık Veriler</h6>
                         </div>
                         <div class="col-md-3">
                             <label for="yil2026" class="form-label">2026</label>
                             <input type="date" class="form-control" id="yil2026" name="yil2026">
                         </div>
                         <div class="col-md-3">
                             <label for="yil2027" class="form-label">2027</label>
                             <input type="date" class="form-control" id="yil2027" name="yil2027">
                         </div>
                         <div class="col-md-3">
                             <label for="yil2028" class="form-label">2028</label>
                             <input type="date" class="form-control" id="yil2028" name="yil2028">
                         </div>
                         <div class="col-md-3">
                             <label for="yil2029" class="form-label">2029</label>
                             <input type="date" class="form-control" id="yil2029" name="yil2029">
                         </div>
                         <div class="col-md-3">
                             <label for="yil2030" class="form-label">2030</label>
                             <input type="date" class="form-control" id="yil2030" name="yil2030">
                         </div>
                         <div class="col-md-3">
                             <label for="yil2031" class="form-label">2031</label>
                             <input type="date" class="form-control" id="yil2031" name="yil2031">
                         </div>
                         <div class="col-md-3">
                             <label for="yil2032" class="form-label">2032</label>
                             <input type="date" class="form-control" id="yil2032" name="yil2032">
                         </div>
                         <div class="col-md-3">
                             <label for="yil2033" class="form-label">2033</label>
                             <input type="date" class="form-control" id="yil2033" name="yil2033">
                         </div>
                     </div>
                 </form>
             </div>
             <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                 <button type="button" class="btn btn-primary" onclick="saveCihaz()">Kaydet</button>
             </div>
         </div>
     </div>
 </div>

 <!-- Form Ekleme Modal -->
 <div class="modal fade" id="formEkleModal" tabindex="-1" aria-labelledby="formEkleModalLabel" aria-hidden="true">
     <div class="modal-dialog">
         <div class="modal-content">
             <div class="modal-header">
                 <h5 class="modal-title" id="formEkleModalLabel">Yeni Form Ekle</h5>
                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
             </div>
             <div class="modal-body">
                 <form id="formEkleForm" method="POST" action="{{ url_for('add_form') }}">
                     <div class="mb-3">
                         <label for="formAdi" class="form-label">FORM ADI <span class="text-danger">*</span></label>
                         <input type="text" class="form-control" id="formAdi" name="formAdi" required>
                     </div>
                     <div class="mb-3">
                         <label for="formKodu" class="form-label">FORM KODU <span class="text-danger">*</span></label>
                         <input type="text" class="form-control" id="formKodu" name="formKodu" required>
                     </div>
                     <div class="mb-3">
                         <label for="yayinTarihi" class="form-label">YAYIN TARİHİ <span class="text-danger">*</span></label>
                         <input type="date" class="form-control" id="yayinTarihi" name="yayinTarihi" required>
                     </div>
                     <div class="mb-3">
                         <label for="revizyonTarihi" class="form-label">REVİZYON TARİHİ <span class="text-danger">*</span></label>
                         <input type="date" class="form-control" id="revizyonTarihi" name="revizyonTarihi" required>
                     </div>
                     <div class="mb-3">
                         <label for="revizyonNo" class="form-label">REVİZYON NO <span class="text-danger">*</span></label>
                         <input type="text" class="form-control" id="revizyonNo" name="revizyonNo" required>
                     </div>
                 </form>
             </div>
             <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                 <button type="submit" form="formEkleForm" class="btn btn-primary">Kaydet</button>
             </div>
         </div>
     </div>
 </div>

 <!-- Form Düzenleme Modal -->
 <div class="modal fade" id="formEditModal" tabindex="-1" aria-labelledby="formEditModalLabel" aria-hidden="true">
     <div class="modal-dialog">
         <div class="modal-content">
             <div class="modal-header">
                 <h5 class="modal-title" id="formEditModalLabel">Form Düzenle</h5>
                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
             </div>
             <div class="modal-body">
                 <form id="formEditForm" method="POST">
                     <input type="hidden" id="editFormId" name="formId">
                     <div class="mb-3">
                         <label for="editFormAdi" class="form-label">FORM ADI <span class="text-danger">*</span></label>
                         <input type="text" class="form-control" id="editFormAdi" name="formAdi" required>
                     </div>
                     <div class="mb-3">
                         <label for="editFormKodu" class="form-label">FORM KODU <span class="text-danger">*</span></label>
                         <input type="text" class="form-control" id="editFormKodu" name="formKodu" required>
                     </div>
                     <div class="mb-3">
                         <label for="editYayinTarihi" class="form-label">YAYIN TARİHİ <span class="text-danger">*</span></label>
                         <input type="date" class="form-control" id="editYayinTarihi" name="yayinTarihi" required>
                     </div>
                     <div class="mb-3">
                         <label for="editRevizyonTarihi" class="form-label">REVİZYON TARİHİ <span class="text-danger">*</span></label>
                         <input type="date" class="form-control" id="editRevizyonTarihi" name="revizyonTarihi" required>
                     </div>
                     <div class="mb-3">
                         <label for="editRevizyonNo" class="form-label">REVİZYON NO <span class="text-danger">*</span></label>
                         <input type="text" class="form-control" id="editRevizyonNo" name="revizyonNo" required>
                     </div>
                 </form>
             </div>
             <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                 <button type="submit" form="formEditForm" class="btn btn-primary">Güncelle</button>
             </div>
         </div>
     </div>
 </div>

 <!-- Baca Para Ekleme Modal -->
 <div class="modal fade" id="bacaParaEkleModal" tabindex="-1" aria-labelledby="bacaParaEkleModalLabel" aria-hidden="true">
     <div class="modal-dialog">
         <div class="modal-content">
             <div class="modal-header">
                 <h5 class="modal-title" id="bacaParaEkleModalLabel">Yeni Baca Para Ekle</h5>
                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
             </div>
             <div class="modal-body">
                 <form id="bacaParaForm" method="POST" action="{{ url_for('add_baca_para') }}">
                     <div class="mb-3">
                         <label for="baca_par_adi" class="form-label">BACA PARA ADI <span class="text-danger">*</span></label>
                         <input type="text" class="form-control" id="baca_par_adi" name="baca_par_adi" required>
                     </div>
                     <div class="mb-3">
                         <label for="liste_icerigi" class="form-label">LİSTE İÇERİĞİ</label>
                         <textarea class="form-control" id="liste_icerigi" name="liste_icerigi" rows="4" placeholder="Her satıra bir değer yazın..."></textarea>
                         <div class="form-text">Her satıra bir değer yazın. Örnek: BİOKÜTLE, DOĞAL GAZ, KÖMÜR (Opsiyonel)</div>
                     </div>
                 </form>
             </div>
             <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                 <button type="submit" form="bacaParaForm" class="btn btn-primary">Kaydet</button>
             </div>
         </div>
     </div>
 </div>

 <!-- Baca Para Düzenleme Modal -->
 <div class="modal fade" id="bacaParaEditModal" tabindex="-1" aria-labelledby="bacaParaEditModalLabel" aria-hidden="true">
     <div class="modal-dialog">
         <div class="modal-content">
             <div class="modal-header">
                 <h5 class="modal-title" id="bacaParaEditModalLabel">Baca Para Düzenle</h5>
                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
             </div>
             <div class="modal-body">
                 <form id="bacaParaEditForm" method="POST">
                     <input type="hidden" id="edit_para_id" name="para_id">
                     <div class="mb-3">
                         <label for="edit_baca_par_adi" class="form-label">BACA PARA ADI <span class="text-danger">*</span></label>
                         <input type="text" class="form-control" id="edit_baca_par_adi" name="baca_par_adi" required>
                     </div>
                     <div class="mb-3">
                         <label for="edit_liste_icerigi" class="form-label">LİSTE İÇERİĞİ</label>
                         <textarea class="form-control" id="edit_liste_icerigi" name="liste_icerigi" rows="4" placeholder="Her satıra bir değer yazın..."></textarea>
                         <div class="form-text">Her satıra bir değer yazın. Örnek: BİOKÜTLE, DOĞAL GAZ, KÖMÜR (Opsiyonel)</div>
                     </div>
                 </form>
             </div>
             <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                 <button type="submit" form="bacaParaEditForm" class="btn btn-primary">Güncelle</button>
             </div>
         </div>
     </div>
 </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('userForm');
    const formAction = document.getElementById('formAction');
    const editUsername = document.getElementById('editUsername');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const yeniEkleBtn = document.getElementById('yeniEkleBtn');
    const guncelleBtn = document.getElementById('guncelleBtn');
    const kaydetBtn = document.getElementById('kaydetBtn');

    // Düzenle butonlarına tıklandığında
    document.querySelectorAll('.edit-user-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            const surname = this.getAttribute('data-surname');
            const gorev = this.getAttribute('data-gorev');
            const role = this.getAttribute('data-role');
            
            // Form alanlarını doldur
            usernameInput.value = username;
            document.getElementById('surname').value = surname;
            passwordInput.value = ''; // Şifreyi temizle
            document.getElementById('gorev').value = gorev;
            document.getElementById('role').value = role;
            
            // Form modunu güncelleme olarak değiştir
            formAction.value = 'update_user';
            editUsername.value = username;
            
            // Buton durumlarını değiştir
            yeniEkleBtn.disabled = true;
            guncelleBtn.disabled = false;
            
            // Kullanıcı adı alanını readonly yap
            usernameInput.readOnly = true;
            
            // Sayfayı form alanına kaydır
            form.scrollIntoView({ behavior: 'smooth' });
        });
    });

    // Sil butonlarına tıklandığında
    document.querySelectorAll('.delete-user-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            if (confirm(`"${username}" kullanıcısını silmek istediğinizden emin misiniz?`)) {
                // AJAX ile silme işlemi
                fetch('/delete_user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({username: username})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Hata: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Bir hata oluştu!');
                });
            }
        });
    });

    // Yeni ekle butonuna tıklandığında formu submit et
    yeniEkleBtn.addEventListener('click', function() {
        form.submit();
    });
    
    // Güncelle butonuna tıklandığında formu gönder
    guncelleBtn.addEventListener('click', function() {
        form.submit();
    });
    
    // Kaydet butonuna tıklandığında formu gönder
    kaydetBtn.addEventListener('click', function() {
        form.submit();
    });

    // Tümünü seç checkbox'ı
    const tumunuSecCheckbox = document.getElementById('selectAllUsers');
    if (tumunuSecCheckbox) {
        tumunuSecCheckbox.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.user-checkbox:not(:disabled)');
            checkboxes.forEach(function(checkbox) {
                checkbox.checked = tumunuSecCheckbox.checked;
            });
            updateSecilenleriAktarButton();
        });
    }

    // İmza yükleme fonksiyonları
    const imzaInput = document.getElementById('imza');
    const imzaText = document.getElementById('imzaText');
    const imzaPreview = document.getElementById('imzaPreview');
    const imzaImage = document.getElementById('imzaImage');

    // İmza dosyası seçildiğinde
    imzaInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Dosya adını göster
            imzaText.value = file.name;
            
            // Önizleme göster
            const reader = new FileReader();
            reader.onload = function(e) {
                imzaImage.src = e.target.result;
                imzaPreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            imzaText.value = '';
            imzaPreview.style.display = 'none';
        }
    });

    // Düzenle butonlarına imza verisi ekle
    document.querySelectorAll('.edit-user-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const imza = this.getAttribute('data-imza');
            if (imza) {
                imzaText.value = imza;
                imzaImage.src = '/static/images/signatures/' + imza;
                imzaPreview.style.display = 'block';
            } else {
                imzaText.value = '';
                imzaPreview.style.display = 'none';
            }
        });
    });

    // Tekil checkbox'lar
    const kullaniciCheckboxes = document.querySelectorAll('.user-checkbox');
    kullaniciCheckboxes.forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            updateSecilenleriAktarButton();
            const allCheckboxes = document.querySelectorAll('.user-checkbox:not(:disabled)');
            const checkedCheckboxes = document.querySelectorAll('.user-checkbox:checked');
            if (tumunuSecCheckbox) {
                tumunuSecCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length;
            }
        });
    });

    // Seçilenleri sil butonu
    const secilenleriSilButton = document.getElementById('deleteSelectedUsers');
    if (secilenleriSilButton) {
        secilenleriSilButton.addEventListener('click', function() {
            const selectedUsernames = [];
            document.querySelectorAll('.user-checkbox:checked').forEach(function(checkbox) {
                selectedUsernames.push(checkbox.value);
            });
            
            if (selectedUsernames.length > 0) {
                if (confirm('Seçilen ' + selectedUsernames.length + ' kullanıcıyı silmek istediğinizden emin misiniz?')) {
                    // AJAX ile silme işlemi
                    fetch('/delete_selected_users', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({usernames: selectedUsernames})
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload();
                        } else {
                            alert('Hata: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Bir hata oluştu!');
                    });
                }
            }
        });
    }

    // Seçilenleri dışa aktar butonu
    const secilenleriAktarButton = document.getElementById('exportSelectedUsers');
    if (secilenleriAktarButton) {
        secilenleriAktarButton.addEventListener('click', function() {
            const selectedUsernames = [];
            document.querySelectorAll('.user-checkbox:checked').forEach(function(checkbox) {
                selectedUsernames.push(checkbox.value);
            });
            
            if (selectedUsernames.length > 0) {
                const usernamesParam = selectedUsernames.join(',');
                window.location.href = '/export_selected_users?usernames=' + usernamesParam;
            }
        });
    }

    function updateSecilenleriAktarButton() {
        const checkedCount = document.querySelectorAll('.user-checkbox:checked').length;
        
        if (secilenleriAktarButton) {
            secilenleriAktarButton.disabled = checkedCount === 0;
            if (checkedCount > 0) {
                secilenleriAktarButton.innerHTML = '<i class="fas fa-download me-1"></i>Seçilenleri Dışa Aktar (' + checkedCount + ')';
            } else {
                secilenleriAktarButton.innerHTML = '<i class="fas fa-download me-1"></i>Seçilenleri Dışa Aktar';
            }
        }
        
        if (secilenleriSilButton) {
            secilenleriSilButton.disabled = checkedCount === 0;
            if (checkedCount > 0) {
                secilenleriSilButton.innerHTML = '<i class="fas fa-trash me-1"></i>Seçilenleri Sil (' + checkedCount + ')';
            } else {
                secilenleriSilButton.innerHTML = '<i class="fas fa-trash me-1"></i>Seçilenleri Sil';
            }
        }
    }
    
    // İlk yüklemede buton durumunu güncelle
    updateSecilenleriAktarButton();

    // Parametre Yönetimi Fonksiyonları
    const tumunuSecParametreCheckbox = document.getElementById('tumunuSec');
    const secilenleriAktarParametreButton = document.getElementById('secilenleriAktar');
    const secilenleriSilParametreButton = document.getElementById('secilenleriSil');
    
    // Tümünü seç checkbox'ı
    if (tumunuSecParametreCheckbox) {
        tumunuSecParametreCheckbox.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.parametre-checkbox:not(:disabled)');
            checkboxes.forEach(function(checkbox) {
                checkbox.checked = tumunuSecParametreCheckbox.checked;
            });
            updateParametreButtons();
        });
    }

    // Tekil checkbox'lar
    const parametreCheckboxes = document.querySelectorAll('.parametre-checkbox');
    parametreCheckboxes.forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            updateParametreButtons();
            const allCheckboxes = document.querySelectorAll('.parametre-checkbox:not(:disabled)');
            const checkedCheckboxes = document.querySelectorAll('.parametre-checkbox:checked');
            if (tumunuSecParametreCheckbox) {
                tumunuSecParametreCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length;
            }
        });
    });

         // Seçilenleri sil butonu
     if (secilenleriSilParametreButton) {
         secilenleriSilParametreButton.addEventListener('click', function() {
            const selectedIds = [];
            document.querySelectorAll('.parametre-checkbox:checked').forEach(function(checkbox) {
                selectedIds.push(checkbox.value);
            });
            
            if (selectedIds.length > 0) {
                if (confirm('Seçilen ' + selectedIds.length + ' parametreyi silmek istediğinizden emin misiniz?')) {
                    // AJAX ile silme işlemi
                    fetch('/delete_selected_parameters', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ids: selectedIds})
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload();
                        } else {
                            alert('Hata: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Bir hata oluştu!');
                    });
                }
            }
        });
    }

         // Seçilenleri dışa aktar butonu
     if (secilenleriAktarParametreButton) {
         secilenleriAktarParametreButton.addEventListener('click', function() {
            const selectedIds = [];
            document.querySelectorAll('.parametre-checkbox:checked').forEach(function(checkbox) {
                selectedIds.push(checkbox.value);
            });
            
            if (selectedIds.length > 0) {
                const idsParam = selectedIds.join(',');
                window.location.href = '/export_selected_parameters?ids=' + idsParam;
            }
        });
    }

    function updateParametreButtons() {
        const checkedCount = document.querySelectorAll('.parametre-checkbox:checked').length;
        
        if (secilenleriAktarParametreButton) {
            secilenleriAktarParametreButton.disabled = checkedCount === 0;
            if (checkedCount > 0) {
                secilenleriAktarParametreButton.innerHTML = '<i class="fas fa-file-download me-1"></i>Seçilenleri Dışa Aktar (' + checkedCount + ')';
            } else {
                secilenleriAktarParametreButton.innerHTML = '<i class="fas fa-file-download me-1"></i>Seçilenleri Dışa Aktar';
            }
        }
        
        if (secilenleriSilParametreButton) {
            secilenleriSilParametreButton.disabled = checkedCount === 0;
            if (checkedCount > 0) {
                secilenleriSilParametreButton.innerHTML = '<i class="fas fa-trash me-1"></i>Seçilenleri Sil (' + checkedCount + ')';
            } else {
                secilenleriSilParametreButton.innerHTML = '<i class="fas fa-trash me-1"></i>Seçilenleri Sil';
            }
        }
    }

    // Parametre silme butonları
    document.querySelectorAll('.delete-parametre-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            if (confirm('Bu parametreyi silmek istediğinizden emin misiniz?')) {
                // AJAX ile silme işlemi
                fetch('/parametre/delete/' + id, {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Hata: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Bir hata oluştu!');
                });
            }
        });
    });



    // Parametre arama fonksiyonu
    const parametreArama = document.getElementById('parametreArama');
    if (parametreArama) {
        parametreArama.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const table = document.getElementById('parametreTablo');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            }
        });
    }

         // İlk yüklemede parametre buton durumunu güncelle
     updateParametreButtons();

     // Baca Para Yönetimi Fonksiyonları
     
           // Düzenle butonlarına tıklandığında
      document.querySelectorAll('.edit-baca-para-btn').forEach(function(btn) {
          btn.addEventListener('click', function() {
              const id = this.getAttribute('data-id');
              const bacaParAdi = this.getAttribute('data-baca-par-adi');
              const listeIcerigi = this.getAttribute('data-liste-icerigi') || '';
              
              // Modal alanlarını doldur
              document.getElementById('edit_para_id').value = id;
              document.getElementById('edit_baca_par_adi').value = bacaParAdi;
              document.getElementById('edit_liste_icerigi').value = listeIcerigi;
              
              // Form action'ını güncelle
              document.getElementById('bacaParaEditForm').action = '/edit_baca_para/' + id;
              
              // Modal'ı aç
              const modal = new bootstrap.Modal(document.getElementById('bacaParaEditModal'));
              modal.show();
          });
      });

      // Modal kapatıldığında sayfayı yenileme işlemini kaldır
      // Artık sadece başarılı işlemlerden sonra sayfa yenilenecek



                       // Baca Para Ekle butonuna tıklandığında
       const bacaParaEkleBtn = document.querySelector('[data-bs-target="#bacaParaEkleModal"]');
       if (bacaParaEkleBtn) {
           bacaParaEkleBtn.addEventListener('click', function() {
               // Form alanlarını temizle
               document.getElementById('baca_par_adi').value = '';
               document.getElementById('liste_icerigi').value = '';
           });
       }

       // Ekleme modal kapatıldığında sayfayı yenileme işlemini kaldır
       // Artık sadece başarılı işlemlerden sonra sayfa yenilenecek

      // Baca Para butonlarını başlatma fonksiyonu
      function initializeBacaParaButtons() {
          console.log('Baca para butonları yükleniyor...');
          
          // Düzenle butonlarına tıklandığında
          document.querySelectorAll('.edit-baca-para-btn').forEach(function(btn) {
              console.log('Düzenle butonu bulundu:', btn);
              btn.addEventListener('click', function() {
                  console.log('Düzenle butonuna tıklandı');
                  const id = this.getAttribute('data-id');
                  const bacaParAdi = this.getAttribute('data-baca-par-adi');
                  const listeIcerigi = this.getAttribute('data-liste-icerigi') || '';
                  
                  console.log('ID:', id, 'Ad:', bacaParAdi, 'İçerik:', listeIcerigi);
                  
                  // Modal alanlarını doldur
                  document.getElementById('edit_para_id').value = id;
                  document.getElementById('edit_baca_par_adi').value = bacaParAdi;
                  document.getElementById('edit_liste_icerigi').value = listeIcerigi;
                  
                  // Form action'ını güncelle
                  document.getElementById('bacaParaEditForm').action = '/edit_baca_para/' + id;
                  
                  // Modal'ı aç
                  const modal = new bootstrap.Modal(document.getElementById('bacaParaEditModal'));
                  modal.show();
              });
          });

          // Sil butonlarına tıklandığında
          document.querySelectorAll('.delete-baca-para-btn').forEach(function(btn) {
              console.log('Sil butonu bulundu:', btn);
              btn.addEventListener('click', function() {
                  console.log('Sil butonuna tıklandı');
                  const id = this.getAttribute('data-id');
                  const bacaParAdi = this.getAttribute('data-baca-par-adi');
                  
                  console.log('Silinecek ID:', id, 'Ad:', bacaParAdi);
                  
                  if (confirm(`"${bacaParAdi}" parametresini silmek istediğinizden emin misiniz?`)) {
                      // AJAX ile silme işlemi
                      fetch('/delete_baca_para/' + id, {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json',
                          }
                      })
                      .then(response => {
                          console.log('Response status:', response.status);
                          if (response.ok) {
                              return response.json();
                          } else {
                              throw new Error('Network response was not ok');
                          }
                      })
                                             .then(data => {
                           console.log('Response data:', data);
                           if (data.success) {
                               // Başarılı silme işleminden sonra baca bilgileri sekmesi ile sayfayı yenile
                               window.location.href = '/formlar?tab=baca-bilgileri';
                           } else {
                               alert('Hata: ' + (data.error || 'Bilinmeyen hata'));
                           }
                       })
                      .catch(error => {
                          console.error('Error:', error);
                          alert('Bir hata oluştu! Lütfen tekrar deneyin.');
                      });
                  }
              });
          });
      }

      // Sayfa yüklendiğinde butonları başlat
      initializeBacaParaButtons();
      
      // Baca bilgileri checkbox yönetimi
      function initializeBacaParaCheckboxes() {
          // Tümünü seç checkbox'ı
          const tumunuSecBacaCheckbox = document.getElementById('tumunuSecBaca');
          if (tumunuSecBacaCheckbox) {
              tumunuSecBacaCheckbox.addEventListener('change', function() {
                  const checkboxes = document.querySelectorAll('.baca-para-checkbox:not(:disabled)');
                  checkboxes.forEach(function(checkbox) {
                      checkbox.checked = tumunuSecBacaCheckbox.checked;
                  });
                  updateSecilenleriSilBacaButton();
              });
          }

          // Tekil checkbox'lar
          const bacaParaCheckboxes = document.querySelectorAll('.baca-para-checkbox');
          bacaParaCheckboxes.forEach(function(checkbox) {
              checkbox.addEventListener('change', function() {
                  updateSecilenleriSilBacaButton();
                  const allCheckboxes = document.querySelectorAll('.baca-para-checkbox:not(:disabled)');
                  const checkedCheckboxes = document.querySelectorAll('.baca-para-checkbox:checked');
                  if (tumunuSecBacaCheckbox) {
                      tumunuSecBacaCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length;
                  }
              });
          });

          // Seçilenleri sil butonu
          const secilenleriSilBacaButton = document.getElementById('secilenleriSilBaca');
          if (secilenleriSilBacaButton) {
              secilenleriSilBacaButton.addEventListener('click', function() {
                  const selectedIds = [];
                  document.querySelectorAll('.baca-para-checkbox:checked').forEach(function(checkbox) {
                      selectedIds.push(checkbox.value);
                  });
                  
                  if (selectedIds.length > 0) {
                      if (confirm('Seçilen ' + selectedIds.length + ' baca parametresini silmek istediğinizden emin misiniz?')) {
                          // AJAX ile toplu silme işlemi
                          fetch('/delete_selected_baca_para', {
                              method: 'POST',
                              headers: {
                                  'Content-Type': 'application/json',
                              },
                              body: JSON.stringify({ids: selectedIds})
                          })
                          .then(response => response.json())
                          .then(data => {
                              if (data.success) {
                                  // Başarılı silme işleminden sonra baca bilgileri sekmesi ile sayfayı yenile
                                  window.location.href = '/formlar?tab=baca-bilgileri';
                              } else {
                                  alert('Hata: ' + (data.error || 'Bilinmeyen hata'));
                              }
                          })
                          .catch(error => {
                              console.error('Error:', error);
                              alert('Bir hata oluştu! Lütfen tekrar deneyin.');
                          });
                      }
                  }
              });
          }
      }

      // Seçilenleri sil butonunu güncelle
      function updateSecilenleriSilBacaButton() {
          const secilenleriSilBacaButton = document.getElementById('secilenleriSilBaca');
          const checkedCheckboxes = document.querySelectorAll('.baca-para-checkbox:checked');
          
          if (secilenleriSilBacaButton) {
              secilenleriSilBacaButton.disabled = checkedCheckboxes.length === 0;
          }
      }

      // Sayfa yüklendiğinde checkbox'ları başlat
      initializeBacaParaCheckboxes();
      

      

      
      // URL'de sekme parametresi varsa o sekmeyi aktif et
      const urlParams = new URLSearchParams(window.location.search);
      const activeTab = urlParams.get('tab');
      if (activeTab === 'baca-bilgileri') {
          // Baca bilgileri sekmesini aktif et
          const bacaTab = document.getElementById('baca-bilgileri-tab');
          const bacaContent = document.getElementById('baca-bilgileri');
          if (bacaTab && bacaContent) {
              // Tüm sekmeleri pasif et
              document.querySelectorAll('.nav-link').forEach(tab => tab.classList.remove('active'));
              document.querySelectorAll('.tab-pane').forEach(content => {
                  content.classList.remove('show', 'active');
              });
              
              // Baca bilgileri sekmesini aktif et
              bacaTab.classList.add('active');
              bacaContent.classList.add('show', 'active');
          }
      }
      
      // PAR_SAHA sekmesi aktif olduğunda kalıcı satırları yükle
      // Bu fonksiyon artık kullanılmıyor - location.reload() kullanıyoruz


      });
 </script>

<script>
// Global fonksiyonlar - sayfa yüklenmeden önce tanımla
function addParametreRow(parametreType) {
    const table = document.getElementById('parametreTable');
    const tbody = table.querySelector('tbody');
    
    // Yeni satır oluştur
    const newRow = document.createElement('tr');
    newRow.className = 'new-parametre-row';
    newRow.setAttribute('data-parametre-type', parametreType);
    
    // Sütun sayısına göre hücreler oluştur
    const columnCount = 9; // Toplam 9 sütun
    
    for (let i = 0; i < columnCount; i++) {
        const cell = document.createElement('td');
        
        // Hangi sütun olduğunu belirle
        let columnType = '';
        if (i === 0) columnType = 'genel';
        else if (i === 1) columnType = 'nem';
        else if (i === 2) columnType = 'yg';
        else if (i === 3) columnType = 'toc';
        else if (i === 4) columnType = 'voc';
        else if (i === 5) columnType = 'pm10';
        else if (i === 6) columnType = 'ct';
        else columnType = 'bos';
        
        if (columnType === parametreType) {
            // Seçilen sütun için input alanı
            cell.innerHTML = `
                <div class="input-group">
                    <input type="text" class="form-control form-control-sm" placeholder="Yeni alan adı yazın..." id="newField_${parametreType}_${Date.now()}">
                    <button type="button" class="btn btn-success btn-sm" onclick="saveNewField('${parametreType}', this)">
                        <i class="fas fa-save"></i>
                    </button>
                    <button type="button" class="btn btn-danger btn-sm" onclick="cancelNewField(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        } else {
            // Diğer sütunlar boş
            cell.innerHTML = '';
        }
        
        newRow.appendChild(cell);
    }
    
    // Yeni satırı tabloya ekle
    tbody.appendChild(newRow);
    
    // Input alanına focus ol
    const input = newRow.querySelector('input');
    if (input) {
        input.focus();
    }
}

function saveNewField(parametreType, button) {
    const input = button.parentElement.querySelector('input');
    const fieldName = input.value.trim();
    
    if (!fieldName) {
        alert('Lütfen alan adı yazın!');
        return;
    }
    
    // Backend'e gönder
    fetch('/save_parametre_field', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            parametreType: parametreType,
            fieldName: fieldName
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            // Satırı kaldır
            const row = button.closest('tr');
            row.remove();
            
            // Tabloyu güncelle (kalıcı satırlar için)
            location.reload();
        } else {
            alert('Hata: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Sunucu hatası! Lütfen tekrar deneyin.');
    });
}

function cancelNewField(button) {
    const row = button.closest('tr');
    row.remove();
}

// Bu fonksiyonlar artık kullanılmıyor - location.reload() kullanıyoruz

// Bu fonksiyon artık kullanılmıyor - location.reload() kullanıyoruz



// Bu fonksiyon artık kullanılmıyor

// Bu fonksiyon artık kullanılmıyor

// Bu fonksiyon artık kullanılmıyor

// Bu fonksiyonlar artık kullanılmıyor

function importParametreFields() {
    if (confirm('⚠️ DİKKAT: İçe aktar yaptığınızda mevcut tüm alanlar silinecek ve Excel\'deki alanlar eklenecek. Devam etmek istiyor musunuz?')) {
        document.getElementById('parametreFieldsFile').click();
    }
}

function handleParametreFieldsFile(input) {
    const file = input.files[0];
    if (!file) return;
    
    const formData = new FormData();
    formData.append('file', file);
    
    fetch('/import_parametre_fields', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('İçe aktarma hatası');
        }
    })
    .then(data => {
        alert(data.message);
        location.reload();
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Sunucu hatası! Lütfen tekrar deneyin.');
    })
    .finally(() => {
        input.value = ''; // Dosya input'unu temizle
    });
}

function exportParametreFields() {
    fetch('/export_parametre_fields')
    .then(response => {
        if (response.ok) {
            return response.blob();
        }
        throw new Error('Dışa aktarma hatası');
    })
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `parametre_fields_${new Date().toISOString().split('T')[0]}.xlsx`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Dışa aktarma hatası! Lütfen tekrar deneyin.');
    });
}

function clearParametreFields() {
    if (confirm('Tüm parametre alanlarını silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
        fetch('/clear_parametre_fields', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            if (response.ok) {
                alert('Tüm parametre alanları silindi!');
                location.reload();
            } else {
                throw new Error('Silme hatası');
            }
        })
        .catch(error => {
            console.error('Hata:', error);
            alert('Silme hatası! Lütfen tekrar deneyin.');
        });
    }
}


// "İçe/Dışa Aktarma Format Tablosu" için hücre içi düzenleme ve kaydetme
let importExportEditEnabled = false;

function toggleEditImportExportTable() {
    importExportEditEnabled = !importExportEditEnabled;
    const cells = document.querySelectorAll('#importExportTable tbody td');
    cells.forEach(td => {
        td.contentEditable = importExportEditEnabled ? 'true' : 'false';
        td.classList.toggle('table-warning', importExportEditEnabled);
    });
    const btn = document.getElementById('toggleEditImportExport');
    if (btn) {
        btn.innerHTML = importExportEditEnabled
            ? '<i class="fas fa-ban me-1"></i>Düzenlemeyi Kapat'
            : '<i class="fas fa-edit me-1"></i>Düzenleme';
    }
}

function collectImportExportRows() {
    const rows = [];
    const trs = document.querySelectorAll('#importExportTable tbody tr');
    trs.forEach(tr => {
        const row = [];
        tr.querySelectorAll('td').forEach(td => {
            row.push(td.innerText.trim());
        });
        rows.push(row);
    });
    return rows;
}

function saveImportExportTable() {
    const rows = collectImportExportRows();
    fetch('/save_parametre_fields_table', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ rows })
    })
    .then(response => response.json())
    .then(data => {
        if (data && data.success) {
            alert(data.message || 'Tablo başarıyla kaydedildi');
        } else {
            alert('Hata: ' + (data && data.message ? data.message : 'Bilinmeyen hata'));
        }
    })
    .catch(err => {
        console.error('Kaydetme hatası:', err);
        alert('Sunucu hatası! Lütfen tekrar deneyin.');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('toggleEditImportExport');
    if (toggleBtn) {
        toggleBtn.addEventListener('click', toggleEditImportExportTable);
    }
    const saveBtn = document.getElementById('saveImportExport');
    if (saveBtn) {
        saveBtn.addEventListener('click', saveImportExportTable);
    }
});

</script>

<script>
// Form Yönetimi JavaScript Fonksiyonları
document.addEventListener('DOMContentLoaded', function() {
    // Emisyon formu sekmesi aktif olduğunda formları yükle
    const emisyonFormTab = document.getElementById('emisyon-form-tab');
    if (emisyonFormTab) {
        emisyonFormTab.addEventListener('click', function() {
            loadForms();
        });
    }
    
    // Form ekleme modal kapatıldığında formu temizle
    const formEkleModal = document.getElementById('formEkleModal');
    if (formEkleModal) {
        formEkleModal.addEventListener('hidden.bs.modal', function() {
            document.getElementById('formEkleForm').reset();
        });
    }
});

// Formları yükle
function loadForms() {
    fetch('/api/forms')
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById('formTabloBody');
            tbody.innerHTML = '';
            
            if (Array.isArray(data) && data.length > 0) {
                data.forEach((form, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="text-center fw-bold text-muted">${index + 1}</td>
                        <td>${form.formAdi || ''}</td>
                        <td>${form.formKodu || ''}</td>
                        <td>${form.yayinTarihi || ''}</td>
                        <td>${form.revizyonTarihi || ''}</td>
                        <td>${form.revizyonNo || ''}</td>
                        <td class="text-end">
                            <div class="btn-group btn-group-sm" role="group">
                                <button type="button" class="btn btn-outline-warning edit-form-btn" 
                                        data-id="${form.id}" 
                                        data-form-adi="${form.formAdi}"
                                        data-form-kodu="${form.formKodu}"
                                        data-yayin-tarihi="${form.yayinTarihi}"
                                        data-revizyon-tarihi="${form.revizyonTarihi}"
                                        data-revizyon-no="${form.revizyonNo}"
                                        title="Düzenle">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                                <button type="button" class="btn btn-outline-danger delete-form-btn" 
                                        data-id="${form.id}"
                                        data-form-adi="${form.formAdi}"
                                        title="Sil">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Event listener'ları ekle
                addFormEventListeners();
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-2x mb-2"></i>
                            <br>Henüz form bulunmuyor
                        </td>
                    </tr>
                `;
            }
        })
        .catch(error => {
            console.error('Formlar yüklenirken hata:', error);
        });
}

// Form event listener'larını ekle
function addFormEventListeners() {
    // Düzenle butonları
    document.querySelectorAll('.edit-form-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const formAdi = this.getAttribute('data-form-adi');
            const formKodu = this.getAttribute('data-form-kodu');
            const yayinTarihi = this.getAttribute('data-yayin-tarihi');
            const revizyonTarihi = this.getAttribute('data-revizyon-tarihi');
            const revizyonNo = this.getAttribute('data-revizyon-no');
            
            // Modal alanlarını doldur
            document.getElementById('editFormId').value = id;
            document.getElementById('editFormAdi').value = formAdi;
            document.getElementById('editFormKodu').value = formKodu;
            document.getElementById('editYayinTarihi').value = yayinTarihi;
            document.getElementById('editRevizyonTarihi').value = revizyonTarihi;
            document.getElementById('editRevizyonNo').value = revizyonNo;
            
            // Form action'ını güncelle
            document.getElementById('formEditForm').action = '/edit_form/' + id;
            
            // Modal'ı aç
            const modal = new bootstrap.Modal(document.getElementById('formEditModal'));
            modal.show();
        });
    });

    // Sil butonları
    document.querySelectorAll('.delete-form-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const formAdi = this.getAttribute('data-form-adi');
            
            if (confirm(`"${formAdi}" formunu silmek istediğinizden emin misiniz?`)) {
                fetch('/delete_form/' + id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(data.message);
                        loadForms(); // Tabloyu yenile
                    } else {
                        alert('Hata: ' + (data.error || 'Bilinmeyen hata'));
                    }
                })
                .catch(error => {
                    console.error('Silme hatası:', error);
                    alert('Silme sırasında hata oluştu!');
                });
            }
        });
    });
}

// Form dışa aktarma fonksiyonu
function exportForms(format) {
    // Loading göster
    const buttons = document.querySelectorAll('.btn-group .btn');
    buttons.forEach(btn => btn.disabled = true);
    
    fetch('/export_forms', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            format: format
        })
    })
    .then(response => {
        if (response.ok) {
            return response.blob();
        } else {
            throw new Error('Dışa aktarma hatası');
        }
    })
    .then(blob => {
        // Dosyayı indir
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        
        const now = new Date();
        const timestamp = now.getFullYear() + 
                         String(now.getMonth() + 1).padStart(2, '0') + 
                         String(now.getDate()).padStart(2, '0') + '_' +
                         String(now.getHours()).padStart(2, '0') + 
                         String(now.getMinutes()).padStart(2, '0');
        
        if (format === 'excel') {
            a.download = `Formlar_${timestamp}.xlsx`;
        } else if (format === 'word') {
            a.download = `Formlar_${timestamp}.docx`;
        } else if (format === 'pdf') {
            a.download = `Formlar_${timestamp}.pdf`;
        }
        
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        // Başarı mesajı
        alert(`${format.toUpperCase()} formatında dışa aktarma başarılı!`);
    })
    .catch(error => {
        console.error('Dışa aktarma hatası:', error);
        alert('Dışa aktarma sırasında hata oluştu!');
    })
    .finally(() => {
        // Butonları tekrar aktif et
        buttons.forEach(btn => btn.disabled = false);
    });
}

// ASG.FIYAT Tablosu için JavaScript fonksiyonları
// Tüm satırlara checkbox ve sıra numarası ekle, işlemler hücresini garanti et
function setupAsgRowPrefixesAndActions() {
    const tbody = document.querySelector('#asg-fiyat table tbody');
    if (!tbody) return;
    const rows = Array.from(tbody.querySelectorAll('tr'));
    rows.forEach((row, idx) => {
        // Her satıra checkbox ve sıra numarası ekle
        const firstCell = row.querySelector('td:first-child');
        const hasCheckbox = firstCell && firstCell.querySelector('input.asg-row-checkbox');
        
        if (!hasCheckbox) {
            // Checkbox ekle
            const checkboxTd = document.createElement('td');
            const cb = document.createElement('input');
            cb.type = 'checkbox';
            cb.className = 'asg-row-checkbox';
            checkboxTd.appendChild(cb);
            row.insertBefore(checkboxTd, row.firstChild);

            // Sıra numarası ekle
            const orderTd = document.createElement('td');
            orderTd.textContent = String(idx + 1);
            row.insertBefore(orderTd, row.children[1]);
        } else {
            // Mevcut sıra güncelle
            const orderCell = row.children[1];
            if (orderCell) orderCell.textContent = String(idx + 1);
        }

        // İşlemler hücresi ekle (eğer yoksa)
        const lastTd = row.lastElementChild;
        const hasActions = lastTd && lastTd.querySelector('.btn-group');
        if (!hasActions) {
            const actionsTd = document.createElement('td');
            actionsTd.innerHTML = `
                <div class="btn-group btn-group-sm">
                    <button type="button" class="btn btn-outline-secondary asg-detail" title="Detay"><i class="fas fa-eye"></i></button>
                    <button type="button" class="btn btn-outline-primary asg-edit" title="Düzenle"><i class="fas fa-pencil"></i></button>
                    <button type="button" class="btn btn-outline-warning asg-update" title="Güncelle"><i class="fas fa-sync"></i></button>
                    <button type="button" class="btn btn-outline-danger asg-delete" title="Sil"><i class="fas fa-times"></i></button>
                </div>`;
            row.appendChild(actionsTd);
        }
    });

    // Select all checkbox davranışı
    const selectAll = document.getElementById('asgSelectAll');
    if (selectAll) {
        selectAll.addEventListener('change', () => {
            tbody.querySelectorAll('input.asg-row-checkbox').forEach(cb => {
                cb.checked = selectAll.checked;
            });
        });
    }

    // Buton olayları
    tbody.querySelectorAll('.asg-edit').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const row = e.currentTarget.closest('tr');
            // Önce parametre alanına odaklan, yoksa metot alanına, yoksa ilk fiyat alanına
            const paramInput = row.querySelector('td:nth-child(3) input[type="text"]');
            const metotInput = row.querySelector('td:nth-child(4) input[type="text"]');
            const firstPriceInput = row.querySelector('td input[type="number"]');
            
            if (paramInput) {
                paramInput.focus();
            } else if (metotInput) {
                metotInput.focus();
            } else if (firstPriceInput) {
                firstPriceInput.focus();
            }
            
            row.classList.add('table-warning');
            setTimeout(() => row.classList.remove('table-warning'), 700);
        });
    });
    tbody.querySelectorAll('.asg-update').forEach(btn => {
        btn.addEventListener('click', () => {
            saveAsgFiyatTable();
        });
    });
    tbody.querySelectorAll('.asg-delete').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const row = e.currentTarget.closest('tr');
            const param = row.children[2] ? row.children[2].textContent.trim() : '';
            if (confirm(`${param} satırındaki tüm yıl değerleri temizlensin mi?`)) {
                row.querySelectorAll('td input[type="number"]').forEach(inp => inp.value = '');
            }
        });
    });
    tbody.querySelectorAll('.asg-detail').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const row = e.currentTarget.closest('tr');
            const paramInput = row.children[2] ? row.children[2].querySelector('input') : null;
            const metotInput = row.children[3] ? row.children[3].querySelector('input') : null;
            const param = paramInput ? paramInput.value : (row.children[2] ? row.children[2].textContent.trim() : '');
            const metot = metotInput ? metotInput.value : (row.children[3] ? row.children[3].textContent.trim() : '');
            const values = Array.from(row.querySelectorAll('td input[type="number"]')).map(i => i.value || '');
            alert(`Parametre: ${param}\nMetot: ${metot}\nDeğerler: ${values.join(' | ')}`);
        });
    });
}

// Mevcut hücre metinlerini koruyarak input'a dönüştür
function makeAsgCellsEditable() {
    const tbody = document.querySelector('#asg-fiyat table tbody');
    if (!tbody) return;
    const rows = tbody.querySelectorAll('tr');
    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (cells.length === 0) return;
        
        // Parametre sütunu (3. sütun) - düzenlenebilir yap
        if (cells[2] && !cells[2].querySelector('input')) {
            const paramText = cells[2].textContent.trim();
            cells[2].innerHTML = `<input type="text" class="form-control form-control-sm" value="${paramText}" placeholder="Parametre">`;
        }
        
        // Metot sütunu (4. sütun) - düzenlenebilir yap
        if (cells[3] && !cells[3].querySelector('input')) {
            const metotText = cells[3].textContent.trim();
            cells[3].innerHTML = `<input type="text" class="form-control form-control-sm" value="${metotText}" placeholder="Metot">`;
        }
        
        // Yıl sütunları (5. sütundan itibaren) - düzenlenebilir yap
        const lastIndex = (cells[cells.length - 1].querySelector('.btn-group')) ? cells.length - 1 : cells.length;
        for (let i = 4; i < lastIndex; i++) {
            const cell = cells[i];
            if (!cell) continue;
            if (!cell.querySelector('input')) {
                const existingText = cell.textContent.trim();
                // Hücreyi input'a çevirirken mevcut değeri koru
                const safeValue = existingText.replace(/\s+/g, '');
                cell.innerHTML = '<input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00">';
                const input = cell.querySelector('input');
                if (safeValue !== '' && !isNaN(Number(safeValue.replace(',','.')))) {
                    // Virgülü noktaya çevirerek sayıya uygula
                    input.value = safeValue.replace(',', '.');
                }
            }
        }
    });
}

function saveAsgFiyatTable() {
    const table = document.querySelector('#asg-fiyat table tbody');
    const rows = table.querySelectorAll('tr');
    const data = [];
    
    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (cells.length > 0) {
            const rowData = {
                parametre: '',
                metot: '',
                yillar: []
            };
            
            // Parametre değerini al (3. sütun)
            if (cells[2]) {
                const paramInput = cells[2].querySelector('input');
                rowData.parametre = paramInput ? paramInput.value : cells[2].textContent.trim();
            }
            
            // Metot değerini al (4. sütun)
            if (cells[3]) {
                const metotInput = cells[3].querySelector('input');
                rowData.metot = metotInput ? metotInput.value : cells[3].textContent.trim();
            }
            
            // Yıl sütunlarından verileri al (5. sütundan sonra, işlemler sütunu hariç)
            for (let i = 4; i < cells.length - 1; i++) {
                const input = cells[i].querySelector('input');
                rowData.yillar.push(input ? input.value : '');
            }
            
            data.push(rowData);
        }
    });
    
    // LocalStorage'a kaydet
    localStorage.setItem('asgFiyatData', JSON.stringify(data));
    alert('Asgari fiyat tablosu başarıyla kaydedildi!');
}

function exportAsgFiyatTable() {
    if (typeof XLSX === 'undefined') {
        alert('Excel kütüphanesi yüklenemedi. Lütfen sayfayı yenileyin.');
        return;
    }
    const container = document.querySelector('#asg-fiyat');
    if (!container) return;
    const tbody = container.querySelector('table tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));

    // Başlık satırları (ekrandaki yapıya paralel)
    const years = [
        '2025','2026','2027','2028','2029','2030','2031','2032','2033','2034'
    ];
    const headerRow1 = ['SEÇ','SIRA','PARAMETRE','METOT','YIL',...Array(years.length-1).fill(''),'İŞLEMLER'];
    const headerRow2 = ['', '', '', '', ...years, ''];

    const aoa = [headerRow1, headerRow2];

    const normalizeNumber = (v) => {
        const s = String(v ?? '').trim();
        if (s === '') return '';
        const num = parseFloat(s.replace(',', '.'));
        return isNaN(num) ? s : num;
    };

    rows.forEach((row, idx) => {
        const tds = Array.from(row.querySelectorAll('td'));

        // SEÇ
        const cb = row.querySelector('input.asg-row-checkbox');
        const secCell = cb && cb.checked ? '✓' : '';

        // SIRA
        const siraCell = tds[1] ? tds[1].textContent.trim() : String(idx + 1);

        // PARAMETRE
        let parametreCell = '';
        if (tds[2]) {
            const inp = tds[2].querySelector('input');
            parametreCell = inp ? inp.value : tds[2].textContent.trim();
        }

        // METOT
        let metotCell = '';
        if (tds[3]) {
            const inp = tds[3].querySelector('input');
            metotCell = inp ? inp.value : tds[3].textContent.trim();
        }

        // YIL değerleri (5. sütundan itibaren, son sütun işlemler)
        const yilValues = [];
        for (let i = 4; i < tds.length - 1; i += 1) {
            const inp = tds[i].querySelector('input');
            const val = inp ? inp.value : tds[i].textContent.trim();
            yilValues.push(normalizeNumber(val));
        }

        // İŞLEMLER (metin taşımıyoruz)
        const islem = '';

        aoa.push([secCell, siraCell, parametreCell, metotCell, ...yilValues, islem]);
    });

    // Sheet oluştur
    const ws = XLSX.utils.aoa_to_sheet(aoa);

    // "YIL" başlığını birleştir (E1:N1)
    ws['!merges'] = [
        { s: { r:0, c:4 }, e: { r:0, c:13 } }
    ];

    // Sütun genişlikleri
    ws['!cols'] = [
        { wch: 5 },   // SEÇ
        { wch: 6 },   // SIRA
        { wch: 25 },  // PARAMETRE
        { wch: 25 },  // METOT
        { wch: 10 }, { wch: 10 }, { wch: 10 }, { wch: 10 }, { wch: 10 },
        { wch: 10 }, { wch: 10 }, { wch: 10 }, { wch: 10 }, { wch: 10 },
        { wch: 12 }   // İŞLEMLER
    ];

    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Asgari Fiyatlar');
    const fileName = `asgari_fiyatlar_${new Date().toISOString().split('T')[0]}.xlsx`;
    XLSX.writeFile(wb, fileName);
}

function deleteSelectedAsgRows() {
    const selectedRows = document.querySelectorAll('#asg-fiyat input.asg-row-checkbox:checked');
    if (selectedRows.length === 0) {
        alert('Lütfen silinecek satırları seçin!');
        return;
    }
    
    if (confirm(`${selectedRows.length} adet satırın fiyat değerleri temizlenecek. Emin misiniz?`)) {
        selectedRows.forEach(checkbox => {
            const row = checkbox.closest('tr');
            if (row) {
                // Sadece yıl değerlerini temizle (fiyat input'ları)
                row.querySelectorAll('td input[type="number"]').forEach(input => {
                    input.value = '';
                });
                // Checkbox'ı temizle
                checkbox.checked = false;
            }
        });
        alert('Seçilen satırların fiyat değerleri temizlendi!');
    }
}

function importAsgFiyatTable() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.xlsx,.xls,.csv';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                if (file.name.endsWith('.csv')) {
                    // CSV dosyası okuma
                    const csvContent = e.target.result;
                    const lines = csvContent.split('\n');
                    const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
                    
                    // CSV verilerini tabloya yükle
                    loadCsvDataToTable(lines.slice(1));
                } else {
                    // Excel dosyası okuma
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // Excel verilerini tabloya yükle
                    loadExcelDataToTable(jsonData.slice(1));
                }
                alert('Dosya başarıyla içe aktarıldı!');
            } catch (error) {
                console.error('Dosya okuma hatası:', error);
                alert('Dosya okunurken hata oluştu!');
            }
        };
        
        if (file.name.endsWith('.csv')) {
            reader.readAsText(file, 'UTF-8');
        } else {
            reader.readAsArrayBuffer(file);
        }
    };
    input.click();
}

function loadCsvDataToTable(lines) {
    const tbody = document.querySelector('#asg-fiyat table tbody');
    const rows = tbody.querySelectorAll('tr');
    
    lines.forEach((line, index) => {
        if (index < rows.length && line.trim()) {
            const values = line.split(',').map(v => v.replace(/"/g, '').trim());
            const row = rows[index];
            const inputs = row.querySelectorAll('td input[type="number"]');
            
            // 4. sütundan sonraki değerleri yükle (checkbox, sıra, parametre, metot sonrası)
            for (let i = 0; i < inputs.length && i + 4 < values.length; i++) {
                const value = values[i + 4];
                if (value && !isNaN(Number(value))) {
                    inputs[i].value = value;
                }
            }
        }
    });
}

function loadExcelDataToTable(data) {
    const tbody = document.querySelector('#asg-fiyat table tbody');
    const rows = tbody.querySelectorAll('tr');
    
    data.forEach((rowData, index) => {
        if (index < rows.length && rowData && rowData.length > 0) {
            const row = rows[index];
            const inputs = row.querySelectorAll('td input[type="number"]');
            
            // 4. sütundan sonraki değerleri yükle
            for (let i = 0; i < inputs.length && i + 4 < rowData.length; i++) {
                const value = rowData[i + 4];
                if (value && !isNaN(Number(value))) {
                    inputs[i].value = value;
                }
            }
        }
    });
}

function addNewAsgRow() {
    const tbody = document.querySelector('#asg-fiyat table tbody');
    const newRow = document.createElement('tr');
    
    // Yeni satır HTML'i
    newRow.innerHTML = `
        <td><input type="checkbox" class="asg-row-checkbox"></td>
        <td>${tbody.children.length + 1}</td>
        <td><input type="text" class="form-control form-control-sm" placeholder="Yeni Parametre"></td>
        <td><input type="text" class="form-control form-control-sm" placeholder="Metot"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td><input type="number" class="form-control form-control-sm" step="0.01" placeholder="0.00"></td>
        <td>
            <div class="btn-group btn-group-sm">
                <button type="button" class="btn btn-outline-secondary asg-detail" title="Detay"><i class="fas fa-eye"></i></button>
                <button type="button" class="btn btn-outline-primary asg-edit" title="Düzenle"><i class="fas fa-pencil"></i></button>
                <button type="button" class="btn btn-outline-warning asg-update" title="Güncelle"><i class="fas fa-sync"></i></button>
                <button type="button" class="btn btn-outline-danger asg-delete" title="Sil"><i class="fas fa-times"></i></button>
            </div>
        </td>
    `;
    
    tbody.appendChild(newRow);
    
    // Yeni satır için buton olaylarını bağla
    const newButtons = newRow.querySelectorAll('.asg-edit, .asg-update, .asg-delete, .asg-detail');
    newButtons.forEach(btn => {
        if (btn.classList.contains('asg-edit')) {
            btn.addEventListener('click', (e) => {
                const row = e.currentTarget.closest('tr');
                const firstInput = row.querySelector('td input[type="text"]');
                if (firstInput) {
                    firstInput.focus();
                    row.classList.add('table-warning');
                    setTimeout(() => row.classList.remove('table-warning'), 700);
                }
            });
        } else if (btn.classList.contains('asg-update')) {
            btn.addEventListener('click', () => {
                saveAsgFiyatTable();
            });
        } else if (btn.classList.contains('asg-delete')) {
            btn.addEventListener('click', (e) => {
                const row = e.currentTarget.closest('tr');
                if (confirm('Bu satırı silmek istediğinizden emin misiniz?')) {
                    row.remove();
                    // Sıra numaralarını güncelle
                    updateRowNumbers();
                }
            });
        } else if (btn.classList.contains('asg-detail')) {
            btn.addEventListener('click', (e) => {
                const row = e.currentTarget.closest('tr');
                const param = row.children[2] ? row.children[2].querySelector('input').value : '';
                const metot = row.children[3] ? row.children[3].querySelector('input').value : '';
                const values = Array.from(row.querySelectorAll('td input[type="number"]')).map(i => i.value || '');
                alert(`Parametre: ${param}\nMetot: ${metot}\nDeğerler: ${values.join(' | ')}`);
            });
        }
    });
    
    // Checkbox olayını bağla
    const newCheckbox = newRow.querySelector('.asg-row-checkbox');
    if (newCheckbox) {
        newCheckbox.addEventListener('change', () => {
            updateSelectAllState();
        });
    }
    
    alert('Yeni satır eklendi!');
}

function updateRowNumbers() {
    const tbody = document.querySelector('#asg-fiyat table tbody');
    const rows = tbody.querySelectorAll('tr');
    rows.forEach((row, index) => {
        const orderCell = row.children[1];
        if (orderCell) {
            orderCell.textContent = String(index + 1);
        }
    });
}

function updateSelectAllState() {
    const tbody = document.querySelector('#asg-fiyat table tbody');
    const checkboxes = tbody.querySelectorAll('input.asg-row-checkbox');
    const selectAll = document.getElementById('asgSelectAll');
    
    if (selectAll) {
        const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
        selectAll.checked = checkedCount === checkboxes.length && checkboxes.length > 0;
        selectAll.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
    }
}

// Zengin Metin Editörü Fonksiyonları
function formatText(editorId, command) {
    const editor = document.getElementById(editorId);
    if (editor) {
        editor.focus();
        document.execCommand(command, false, null);
        autoSaveContent();
    }
}

function changeFontSize(editorId, size) {
    const editor = document.getElementById(editorId);
    if (editor) {
        editor.focus();
        
        // Seçili metin var mı kontrol et
        const selection = window.getSelection();
        if (selection.rangeCount > 0 && !selection.isCollapsed) {
            // Seçili metne uygula - son yaklaşım
            const range = selection.getRangeAt(0);
            const selectedText = range.toString();
            
            // Seçili metni sil ve yeni span ile değiştir
            range.deleteContents();
            const span = document.createElement('span');
            span.style.fontSize = size + 'px';
            span.textContent = selectedText;
            range.insertNode(span);
        } else {
            // Seçili metin yoksa, tüm editöre uygula
            editor.style.fontSize = size + 'px';
        }
        
        autoSaveContent();
    }
}

function changeFontFamily(editorId, fontFamily) {
    const editor = document.getElementById(editorId);
    if (editor) {
        editor.focus();
        
        // Önce styleWithCSS'yi etkinleştir
        document.execCommand('styleWithCSS', false, true);
        
        // Seçili metin var mı kontrol et
        const selection = window.getSelection();
        if (selection.rangeCount > 0 && !selection.isCollapsed) {
            // Seçili metne uygula
            document.execCommand('fontName', false, fontFamily);
        } else {
            // Seçili metin yoksa, tüm editöre uygula
            editor.style.fontFamily = fontFamily;
        }
        
        autoSaveContent();
    }
}

function changeLineHeight(editorId, lineHeight) {
    const editor = document.getElementById(editorId);
    if (editor) {
        editor.focus();
        
        // Seçili metin var mı kontrol et
        const selection = window.getSelection();
        if (selection.rangeCount > 0 && !selection.isCollapsed) {
            // Seçili metni bir span ile sar ve line-height uygula
            const range = selection.getRangeAt(0);
            const selectedContent = range.extractContents();
            const span = document.createElement('span');
            span.style.setProperty('line-height', lineHeight, 'important');
            span.appendChild(selectedContent);
            range.insertNode(span);
            
            // Seçimi temizle
            selection.removeAllRanges();
        } else {
            // Tüm editöre uygula
            editor.style.setProperty('line-height', lineHeight, 'important');
            
            // Tüm paragraf ve liste elemanlarına da uygula
            const paragraphs = editor.querySelectorAll('p');
            paragraphs.forEach(p => {
                p.style.setProperty('line-height', lineHeight, 'important');
            });
            
            const listItems = editor.querySelectorAll('li');
            listItems.forEach(li => {
                li.style.setProperty('line-height', lineHeight, 'important');
            });
            
            const ulElements = editor.querySelectorAll('ul');
            ulElements.forEach(ul => {
                ul.style.setProperty('line-height', lineHeight, 'important');
            });
            
            // Tüm span elemanlarına da uygula
            const spans = editor.querySelectorAll('span');
            spans.forEach(span => {
                span.style.setProperty('line-height', lineHeight, 'important');
            });
        }
        
        console.log(`Satır boşluğu ${lineHeight} olarak uygulandı: ${editorId}`);
        autoSaveContent();
    }
}

function teklifGirisMetniGuncelle() {
    const teklifGirisElement = document.getElementById('teklifGirisText');
    if (!teklifGirisElement) {
        alert('Teklif giriş metni alanı bulunamadı!');
        return;
    }
    
    const girisIcerigi = teklifGirisElement.innerHTML;
    
    if (!girisIcerigi || girisIcerigi.trim() === '' || girisIcerigi.trim() === '<div><br></div>') {
        alert('Güncellenecek içerik bulunamadı! Lütfen teklif giriş metnini yazın.');
        return;
    }
    
    // localStorage'a kaydet
    localStorage.setItem('teklifGirisText', girisIcerigi);
    
    // Başarı mesajı
    const button = event.target;
    const originalText = button.innerHTML;
    const originalClass = button.className;
    
    button.innerHTML = '<i class="fas fa-check me-1"></i>Kaydedildi!';
    button.className = 'btn btn-success';
    
    // 3 saniye sonra orijinal haline döndür
    setTimeout(() => {
        button.innerHTML = originalText;
        button.className = originalClass;
    }, 3000);
    
    console.log('Teklif giriş metni manuel olarak kaydedildi');
    
    // Bilgi mesajı göster
    const infoDiv = document.createElement('div');
    infoDiv.className = 'alert alert-success alert-dismissible fade show mt-2';
    infoDiv.innerHTML = `
        <strong>Başarılı!</strong> Teklif giriş metni kaydedildi. 
        Artık teklif sayfasında "Varsayılan Metni Yükle" butonuna bastığınızda bu metin gelecek.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // Butonu içeren div'in altına ekle
    button.parentElement.appendChild(infoDiv);
    
    // 5 saniye sonra mesajı kaldır
    setTimeout(() => {
        if (infoDiv.parentElement) {
            infoDiv.remove();
        }
    }, 5000);
}

function maddeleriGuncelle() {
    const genelHukumlerElement = document.getElementById('genelHukumlerText');
    if (!genelHukumlerElement) {
        alert('Genel hükümler alanı bulunamadı!');
        return;
    }
    
    const hukumlerIcerigi = genelHukumlerElement.innerHTML;
    
    if (!hukumlerIcerigi || hukumlerIcerigi.trim() === '' || hukumlerIcerigi.trim() === '<div><br></div>') {
        alert('Güncellenecek içerik bulunamadı! Lütfen genel hükümler metnini yazın.');
        return;
    }
    
    // localStorage'a kaydet (hem otomatik kayıt hem de manuel güncelleme için)
    localStorage.setItem('genelHukumlerText', hukumlerIcerigi);
    
    // Başarı mesajı
    const button = event.target;
    const originalText = button.innerHTML;
    const originalClass = button.className;
    
    button.innerHTML = '<i class="fas fa-check me-1"></i>Kaydedildi!';
    button.className = 'btn btn-success';
    
    // 3 saniye sonra orijinal haline döndür
    setTimeout(() => {
        button.innerHTML = originalText;
        button.className = originalClass;
    }, 3000);
    
    console.log('Genel hükümler manuel olarak kaydedildi');
    
    // Bilgi mesajı göster
    const infoDiv = document.createElement('div');
    infoDiv.className = 'alert alert-success alert-dismissible fade show mt-2';
    infoDiv.innerHTML = `
        <strong>Başarılı!</strong> Genel hükümler metni kaydedildi. 
        Artık teklif sayfasında "Varsayılan Hükümleri Yükle" butonuna bastığınızda bu metin gelecek.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // Butonu içeren div'in altına ekle
    button.parentElement.appendChild(infoDiv);
    
    // 5 saniye sonra mesajı kaldır
    setTimeout(() => {
        if (infoDiv.parentElement) {
            infoDiv.remove();
        }
    }, 5000);
}

// LocalStorage ile otomatik kaydetme
function autoSaveContent() {
    const teklifGirisText = document.getElementById('teklifGirisText');
    const genelHukumlerText = document.getElementById('genelHukumlerText');
    
    if (teklifGirisText) {
        localStorage.setItem('teklifGirisText', teklifGirisText.innerHTML);
    }
    
    if (genelHukumlerText) {
        localStorage.setItem('genelHukumlerText', genelHukumlerText.innerHTML);
    }
}

// LocalStorage'dan içerik yükleme
function loadSavedContent() {
    const teklifGirisText = document.getElementById('teklifGirisText');
    const genelHukumlerText = document.getElementById('genelHukumlerText');
    
    if (teklifGirisText) {
        const savedContent = localStorage.getItem('teklifGirisText');
        if (savedContent) {
            teklifGirisText.innerHTML = savedContent;
        }
    }
    
    if (genelHukumlerText) {
        const savedContent = localStorage.getItem('genelHukumlerText');
        if (savedContent) {
            genelHukumlerText.innerHTML = savedContent;
        }
    }
}

// Sayfa yüklendiğinde hücreleri input'a çevir ve kaydedilmiş verileri yükle
document.addEventListener('DOMContentLoaded', function() {
    // 0) Sıra & checkbox & işlemler hücresi kurulum
    setupAsgRowPrefixesAndActions();
    // 1) Mevcut değerleri koruyarak tüm yıl hücrelerini input'a çevir
    makeAsgCellsEditable();

    // 2) Kaydedilmiş veriler varsa input'lara yaz
    const savedData = localStorage.getItem('asgFiyatData');
    if (savedData) {
        const data = JSON.parse(savedData);
        const table = document.querySelector('#asg-fiyat table tbody');
        const rows = table.querySelectorAll('tr');
        
        data.forEach((rowData, index) => {
            if (rows[index]) {
                const cells = rows[index].querySelectorAll('td');
                
                // Parametre değerini yükle (3. sütun)
                if (cells[2] && cells[2].querySelector('input') && rowData.parametre) {
                    cells[2].querySelector('input').value = rowData.parametre;
                }
                
                // Metot değerini yükle (4. sütun)
                if (cells[3] && cells[3].querySelector('input') && rowData.metot) {
                    cells[3].querySelector('input').value = rowData.metot;
                }
                
                // Yıl sütunları (sadece fiyat verileri, işlemler sütunu hariç)
                rowData.yillar.forEach((value, yearIndex) => {
                    const targetIndex = yearIndex + 4; // checkbox,sıra,parametre,metot
                    if (cells[targetIndex] && cells[targetIndex].querySelector('input')) {
                        cells[targetIndex].querySelector('input').value = value || '';
                    }
                });
            }
        });
    }
    
    // 3) Zengin metin editörü içeriklerini yükle
    loadSavedContent();
    
    // 4) Zengin metin editörlerine otomatik kaydetme ekle
    const teklifGirisText = document.getElementById('teklifGirisText');
    const genelHukumlerText = document.getElementById('genelHukumlerText');
    
    if (teklifGirisText) {
        teklifGirisText.addEventListener('input', autoSaveContent);
        teklifGirisText.addEventListener('blur', autoSaveContent);
    }
    
    if (genelHukumlerText) {
        genelHukumlerText.addEventListener('input', autoSaveContent);
        genelHukumlerText.addEventListener('blur', autoSaveContent);
    }
});

// Cihaz Listesi JavaScript Fonksiyonları
let cihazListesi = [];

// Sayfa yüklendiğinde localStorage'dan verileri yükle
document.addEventListener('DOMContentLoaded', function() {
    const savedCihazlar = localStorage.getItem('cihazListesi');
    if (savedCihazlar) {
        cihazListesi = JSON.parse(savedCihazlar);
        updateCihazTable();
    }
});

// Cihaz ekleme modal'ını göster
function showCihazEkleModal() {
    const modal = new bootstrap.Modal(document.getElementById('cihazEkleModal'));
    document.getElementById('cihazEkleForm').reset();
    modal.show();
}

// Cihaz kaydet
function saveCihaz() {
    const form = document.getElementById('cihazEkleForm');
    const formData = new FormData(form);
    
    const cihaz = {
        sira: formData.get('sira') || (cihazListesi.length + 1),
        param: formData.get('param'),
        chzAdi: formData.get('chzAdi'),
        marka: formData.get('marka'),
        model: formData.get('model'),
        seriNo: formData.get('seriNo'),
        yil2026: formData.get('yil2026') || '',
        yil2027: formData.get('yil2027') || '',
        yil2028: formData.get('yil2028') || '',
        yil2029: formData.get('yil2029') || '',
        yil2030: formData.get('yil2030') || '',
        yil2031: formData.get('yil2031') || '',
        yil2032: formData.get('yil2032') || '',
        yil2033: formData.get('yil2033') || ''
    };
    
    // Gerekli alanları kontrol et
    if (!cihaz.param || !cihaz.chzAdi || !cihaz.marka || !cihaz.model || !cihaz.seriNo) {
        alert('Lütfen tüm zorunlu alanları doldurun!');
        return;
    }
    
    cihazListesi.push(cihaz);
    updateCihazTable();
    
    // Modal'ı kapat
    const modal = bootstrap.Modal.getInstance(document.getElementById('cihazEkleModal'));
    modal.hide();
    
    alert('Cihaz başarıyla eklendi!');
}

// Cihaz tablosunu güncelle
function updateCihazTable() {
    const tbody = document.getElementById('cihazTableBody');
    tbody.innerHTML = '';
    
    cihazListesi.forEach((cihaz, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="checkbox" class="cihaz-checkbox" value="${index}">
            </td>
            <td>
                <input type="number" class="form-control form-control-sm" value="${cihaz.sira}" min="1" max="19" 
                       onchange="updateCihazField(${index}, 'sira', this.value)" style="width: 80px;">
            </td>
            <td>
                <select class="form-select form-select-sm" onchange="updateCihazField(${index}, 'param', this.value)" style="width: 120px;">
                    <option value="">Seçin...</option>
                    <option value="YG" ${cihaz.param === 'YG' ? 'selected' : ''}>YG</option>
                    <option value="TOZ" ${cihaz.param === 'TOZ' ? 'selected' : ''}>TOZ</option>
                    <option value="VOC" ${cihaz.param === 'VOC' ? 'selected' : ''}>VOC</option>
                    <option value="TOC" ${cihaz.param === 'TOC' ? 'selected' : ''}>TOC</option>
                    <option value="NEM" ${cihaz.param === 'NEM' ? 'selected' : ''}>NEM</option>
                    <option value="SO2" ${cihaz.param === 'SO2' ? 'selected' : ''}>SO2</option>
                    <option value="NO" ${cihaz.param === 'NO' ? 'selected' : ''}>NO</option>
                    <option value="CO" ${cihaz.param === 'CO' ? 'selected' : ''}>CO</option>
                    <option value="O2" ${cihaz.param === 'O2' ? 'selected' : ''}>O2</option>
                </select>
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" value="${cihaz.chzAdi}" 
                       onchange="updateCihazField(${index}, 'chzAdi', this.value)" style="width: 180px;">
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" value="${cihaz.marka}" 
                       onchange="updateCihazField(${index}, 'marka', this.value)" style="width: 150px;">
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" value="${cihaz.model}" 
                       onchange="updateCihazField(${index}, 'model', this.value)" style="width: 150px;">
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" value="${cihaz.seriNo}" 
                       onchange="updateCihazField(${index}, 'seriNo', this.value)" style="width: 150px;">
            </td>
            <td>
                <input type="date" class="form-control form-control-sm" value="${cihaz.yil2026}" 
                       onchange="updateCihazField(${index}, 'yil2026', this.value)" style="width: 120px;">
            </td>
            <td>
                <input type="date" class="form-control form-control-sm" value="${cihaz.yil2027}" 
                       onchange="updateCihazField(${index}, 'yil2027', this.value)" style="width: 120px;">
            </td>
            <td>
                <input type="date" class="form-control form-control-sm" value="${cihaz.yil2028}" 
                       onchange="updateCihazField(${index}, 'yil2028', this.value)" style="width: 120px;">
            </td>
            <td>
                <input type="date" class="form-control form-control-sm" value="${cihaz.yil2029}" 
                       onchange="updateCihazField(${index}, 'yil2029', this.value)" style="width: 120px;">
            </td>
            <td>
                <input type="date" class="form-control form-control-sm" value="${cihaz.yil2030}" 
                       onchange="updateCihazField(${index}, 'yil2030', this.value)" style="width: 120px;">
            </td>
            <td>
                <input type="date" class="form-control form-control-sm" value="${cihaz.yil2031}" 
                       onchange="updateCihazField(${index}, 'yil2031', this.value)" style="width: 120px;">
            </td>
            <td>
                <input type="date" class="form-control form-control-sm" value="${cihaz.yil2032}" 
                       onchange="updateCihazField(${index}, 'yil2032', this.value)" style="width: 120px;">
            </td>
            <td>
                <input type="date" class="form-control form-control-sm" value="${cihaz.yil2033}" 
                       onchange="updateCihazField(${index}, 'yil2033', this.value)" style="width: 120px;">
            </td>
            <td>
                <button type="button" class="btn btn-outline-danger btn-sm" onclick="deleteCihaz(${index})" title="Sil">
                    <i class="fas fa-times"></i>
                </button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// Yeni satır ekle
function addNewRow() {
    const yeniCihaz = {
        sira: cihazListesi.length + 1,
        param: '',
        chzAdi: '',
        marka: '',
        model: '',
        seriNo: '',
        yil2026: '',
        yil2027: '',
        yil2028: '',
        yil2029: '',
        yil2030: '',
        yil2031: '',
        yil2032: '',
        yil2033: ''
    };
    
    cihazListesi.push(yeniCihaz);
    updateCihazTable();
    
    // localStorage'ı güncelle
    localStorage.setItem('cihazListesi', JSON.stringify(cihazListesi));
    
    // Yeni eklenen satırdaki ilk input'a focus yap
    setTimeout(() => {
        const lastRow = document.querySelector('#cihazTableBody tr:last-child');
        if (lastRow) {
            const firstInput = lastRow.querySelector('input[type="text"]');
            if (firstInput) {
                firstInput.focus();
            }
        }
    }, 100);
}

// Cihaz alanını güncelle
function updateCihazField(index, field, value) {
    if (cihazListesi[index]) {
        cihazListesi[index][field] = value;
        
        // localStorage'ı güncelle (debounce ile)
        clearTimeout(window.saveTimeout);
        window.saveTimeout = setTimeout(() => {
            localStorage.setItem('cihazListesi', JSON.stringify(cihazListesi));
        }, 500); // 500ms bekle, sonra kaydet
    }
}

// Tüm cihazları kaydet
function saveAllCihazlar() {
    if (cihazListesi.length === 0) {
        alert('Kaydedilecek cihaz bulunamadı!');
        return;
    }
    
    // Verileri localStorage'a kaydet
    localStorage.setItem('cihazListesi', JSON.stringify(cihazListesi));
    
    // Başarı mesajı
    alert(`${cihazListesi.length} cihaz başarıyla kaydedildi!`);
    
    // Konsola da yazdır (geliştirme için)
    console.log('Kaydedilen cihazlar:', cihazListesi);
}

// Tüm cihazları seç/seçme
function toggleSelectAllCihazlar() {
    const selectAll = document.getElementById('selectAllCihazlar');
    const checkboxes = document.querySelectorAll('.cihaz-checkbox');
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
}

// Seçilen cihazları sil
function deleteSelectedCihazlar() {
    const checkboxes = document.querySelectorAll('.cihaz-checkbox:checked');
    if (checkboxes.length === 0) {
        alert('Lütfen silmek istediğiniz cihazları seçin!');
        return;
    }
    
    if (confirm(`${checkboxes.length} cihaz silinecek. Emin misiniz?`)) {
        const indices = Array.from(checkboxes).map(cb => parseInt(cb.value)).sort((a, b) => b - a);
        indices.forEach(index => {
            cihazListesi.splice(index, 1);
        });
        updateCihazTable();
        document.getElementById('selectAllCihazlar').checked = false;
        
        // localStorage'ı güncelle
        localStorage.setItem('cihazListesi', JSON.stringify(cihazListesi));
    }
}

// Tek cihaz sil
function deleteCihaz(index) {
    if (confirm('Bu cihazı silmek istediğinizden emin misiniz?')) {
        cihazListesi.splice(index, 1);
        updateCihazTable();
        
        // localStorage'ı güncelle
        localStorage.setItem('cihazListesi', JSON.stringify(cihazListesi));
    }
}

// Cihaz düzenle
function editCihaz(index) {
    const cihaz = cihazListesi[index];
    
    // Form alanlarını doldur
    document.getElementById('cihazParam').value = cihaz.param;
    document.getElementById('cihazAdi').value = cihaz.chzAdi;
    document.getElementById('cihazMarka').value = cihaz.marka;
    document.getElementById('cihazModel').value = cihaz.model;
    document.getElementById('cihazSeriNo').value = cihaz.seriNo;
    document.getElementById('cihazSira').value = cihaz.sira;
    document.getElementById('yil2026').value = cihaz.yil2026;
    document.getElementById('yil2027').value = cihaz.yil2027;
    document.getElementById('yil2028').value = cihaz.yil2028;
    document.getElementById('yil2029').value = cihaz.yil2029;
    document.getElementById('yil2030').value = cihaz.yil2030;
    document.getElementById('yil2031').value = cihaz.yil2031;
    document.getElementById('yil2032').value = cihaz.yil2032;
    document.getElementById('yil2033').value = cihaz.yil2033;
    
    // Modal'ı göster
    const modal = new bootstrap.Modal(document.getElementById('cihazEkleModal'));
    modal.show();
    
    // Kaydet butonunu güncelle
    const saveBtn = document.querySelector('#cihazEkleModal .btn-primary');
    saveBtn.onclick = () => updateCihaz(index);
}

// Cihaz güncelle
function updateCihaz(index) {
    const form = document.getElementById('cihazEkleForm');
    const formData = new FormData(form);
    
    cihazListesi[index] = {
        sira: formData.get('sira') || cihazListesi[index].sira,
        param: formData.get('param'),
        chzAdi: formData.get('chzAdi'),
        marka: formData.get('marka'),
        model: formData.get('model'),
        seriNo: formData.get('seriNo'),
        yil2026: formData.get('yil2026') || '',
        yil2027: formData.get('yil2027') || '',
        yil2028: formData.get('yil2028') || '',
        yil2029: formData.get('yil2029') || '',
        yil2030: formData.get('yil2030') || '',
        yil2031: formData.get('yil2031') || '',
        yil2032: formData.get('yil2032') || '',
        yil2033: formData.get('yil2033') || ''
    };
    
    updateCihazTable();
    
    // Modal'ı kapat
    const modal = bootstrap.Modal.getInstance(document.getElementById('cihazEkleModal'));
    modal.hide();
    
    alert('Cihaz başarıyla güncellendi!');
}

// Seçilen cihazları dışa aktar (Excel formatında)
function exportSelectedCihazlar() {
    const checkboxes = document.querySelectorAll('.cihaz-checkbox:checked');
    if (checkboxes.length === 0) {
        alert('Lütfen dışa aktarmak istediğiniz cihazları seçin!');
        return;
    }
    
    const selectedCihazlar = Array.from(checkboxes).map(cb => cihazListesi[parseInt(cb.value)]);
    
    // Excel dosyası oluştur
    createExcelFile(selectedCihazlar);
}

// Excel dosyası oluştur
function createExcelFile(cihazlar) {
    // XLSX kütüphanesini yükle (eğer yoksa)
    if (typeof XLSX === 'undefined') {
        // XLSX kütüphanesini dinamik olarak yükle
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
        script.onload = () => {
            generateExcelFile(cihazlar);
        };
        document.head.appendChild(script);
    } else {
        generateExcelFile(cihazlar);
    }
}

// Excel dosyasını oluştur ve indir
function generateExcelFile(cihazlar) {
    // Tarih formatını GG.AA.YY'ye çevir
    function formatTarihForExcel(tarihStr) {
        if (!tarihStr) return '';
        try {
            // YYYY-MM-DD formatından GG.AA.YY formatına çevir
            if (tarihStr.includes('-') && tarihStr.length === 10) {
                const tarih = new Date(tarihStr);
                const gun = String(tarih.getDate()).padStart(2, '0');
                const ay = String(tarih.getMonth() + 1).padStart(2, '0');
                const yil = String(tarih.getFullYear()).slice(-2);
                return `${gun}.${ay}.${yil}`;
            }
            return tarihStr;
        } catch (e) {
            return tarihStr;
        }
    }
    
    // Veri hazırla
    const data = [
        ['SIRA', 'PARAM', 'CHZ ADI', 'MARKA', 'MODEL', 'SERİ NO', '2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033']
    ];
    
    cihazlar.forEach(cihaz => {
        data.push([
            cihaz.sira,
            cihaz.param,
            cihaz.chzAdi,
            cihaz.marka,
            cihaz.model,
            cihaz.seriNo,
            formatTarihForExcel(cihaz.yil2026),
            formatTarihForExcel(cihaz.yil2027),
            formatTarihForExcel(cihaz.yil2028),
            formatTarihForExcel(cihaz.yil2029),
            formatTarihForExcel(cihaz.yil2030),
            formatTarihForExcel(cihaz.yil2031),
            formatTarihForExcel(cihaz.yil2032),
            formatTarihForExcel(cihaz.yil2033)
        ]);
    });
    
    // Workbook oluştur
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(data);
    
    // Sütun genişliklerini ayarla
    ws['!cols'] = [
        { width: 8 },   // SIRA
        { width: 12 },  // PARAM
        { width: 20 },  // CHZ ADI
        { width: 15 },  // MARKA
        { width: 15 },  // MODEL
        { width: 15 },  // SERİ NO
        { width: 12 },  // 2026
        { width: 12 },  // 2027
        { width: 12 },  // 2028
        { width: 12 },  // 2029
        { width: 12 },  // 2030
        { width: 12 },  // 2031
        { width: 12 },  // 2032
        { width: 12 }   // 2033
    ];
    
    // Sayfayı workbook'a ekle
    XLSX.utils.book_append_sheet(wb, ws, 'Cihaz Listesi');
    
    // Dosyayı indir
    const fileName = `cihaz_listesi_${new Date().toISOString().slice(0, 10)}.xlsx`;
    XLSX.writeFile(wb, fileName);
    
    alert(`${cihazlar.length} cihaz Excel dosyası olarak indirildi!`);
}

// Excel'den içe aktarım
function importFromExcel() {
    document.getElementById('excelFileInput').click();
}

// Excel dosyasını işle
function handleExcelFile(input) {
    const file = input.files[0];
    if (!file) return;
    
    // XLSX kütüphanesini yükle (eğer yoksa)
    if (typeof XLSX === 'undefined') {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
        script.onload = () => {
            processExcelFile(file);
        };
        document.head.appendChild(script);
    } else {
        processExcelFile(file);
    }
}

// Excel dosyasını işle ve verileri yükle
function processExcelFile(file) {
    const reader = new FileReader();
    
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            
            // İlk sayfayı al
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            
            // Veriyi JSON formatına çevir
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            
            if (jsonData.length < 2) {
                alert('Excel dosyasında yeterli veri bulunamadı!');
                return;
            }
            
            // Başlık satırını kontrol et
            const headers = jsonData[0];
            const expectedHeaders = ['SIRA', 'PARAM', 'CHZ ADI', 'MARKA', 'MODEL', 'SERİ NO', '2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033'];
            
            if (!headers || headers.length < expectedHeaders.length) {
                alert('Excel dosyası formatı uygun değil! Beklenen sütunlar: ' + expectedHeaders.join(', '));
                return;
            }
            
            // Veri satırlarını işle
            const newCihazlar = [];
            for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (row.length === 0 || !row[0]) continue; // Boş satırları atla
                
                const cihaz = {
                    sira: row[0] || (cihazListesi.length + newCihazlar.length + 1),
                    param: row[1] || '',
                    chzAdi: row[2] || '',
                    marka: row[3] || '',
                    model: row[4] || '',
                    seriNo: row[5] || '',
                    yil2026: formatTarihFromExcel(row[6]),
                    yil2027: formatTarihFromExcel(row[7]),
                    yil2028: formatTarihFromExcel(row[8]),
                    yil2029: formatTarihFromExcel(row[9]),
                    yil2030: formatTarihFromExcel(row[10]),
                    yil2031: formatTarihFromExcel(row[11]),
                    yil2032: formatTarihFromExcel(row[12]),
                    yil2033: formatTarihFromExcel(row[13])
                };
                
                newCihazlar.push(cihaz);
            }
            
            if (newCihazlar.length === 0) {
                alert('Excel dosyasında geçerli veri bulunamadı!');
                return;
            }
            
            // Mevcut verilere ekle
            cihazListesi = cihazListesi.concat(newCihazlar);
            updateCihazTable();
            
            // localStorage'ı güncelle
            localStorage.setItem('cihazListesi', JSON.stringify(cihazListesi));
            
            alert(`${newCihazlar.length} cihaz başarıyla Excel'den aktarıldı!`);
            
        } catch (error) {
            console.error('Excel dosyası işlenirken hata:', error);
            alert('Excel dosyası işlenirken hata oluştu! Dosya formatını kontrol edin.');
        }
    };
    
    reader.readAsArrayBuffer(file);
}

// Excel'den gelen tarihi YYYY-MM-DD formatına çevir
function formatTarihFromExcel(tarihStr) {
    if (!tarihStr) return '';
    
    try {
        // GG.AA.YY formatından YYYY-MM-DD formatına çevir
        if (typeof tarihStr === 'string' && tarihStr.includes('.')) {
            const parts = tarihStr.split('.');
            if (parts.length === 3) {
                const gun = parts[0].padStart(2, '0');
                const ay = parts[1].padStart(2, '0');
                let yil = parts[2];
                
                // YY formatını YYYY'ye çevir
                if (yil.length === 2) {
                    const currentYear = new Date().getFullYear();
                    const currentCentury = Math.floor(currentYear / 100) * 100;
                    yil = currentCentury + parseInt(yil);
                }
                
                return `${yil}-${ay}-${gun}`;
            }
        }
        
        // Eğer zaten YYYY-MM-DD formatındaysa
        if (typeof tarihStr === 'string' && tarihStr.includes('-') && tarihStr.length === 10) {
            return tarihStr;
        }
        
        // Excel tarih numarasıysa
        if (typeof tarihStr === 'number') {
            const date = new Date((tarihStr - 25569) * 86400 * 1000);
            return date.toISOString().slice(0, 10);
        }
        
        return tarihStr;
    } catch (e) {
        return tarihStr;
    }
}
</script>



 
{% endblock %} 